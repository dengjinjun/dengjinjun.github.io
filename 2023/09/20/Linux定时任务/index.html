<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Linux定时任务" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--注意：首页既不是post也不是page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--返回顶部css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--目录-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">🍟首页</a></li>
            
        
            
                <li><a href="/list/">📝文章</a></li>
            
        
            
                <li><a href="/tags/">🏷️标签</a></li>
            
        
            
                <li><a href="/categories/">🗂️分类</a></li>
            
        
            
                <li><a href="/about/">👁️关于</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--说明是文章post页面-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Linux定时任务
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">定时任务介绍</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="post-toc-text">定时任务管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%BA%A7%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">系统级计划任务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%94%A8%E6%88%B7%E7%BA%A7%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">用户级计划任务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F"><span class="post-toc-text">计划任务语法格式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%B8%8D%E6%89%A7%E8%A1%8C%E7%9A%84%E5%8F%AF%E8%83%BD%E5%8E%9F%E5%9B%A0"><span class="post-toc-text">定时任务不执行的可能原因</span></a></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="定时任务介绍"><a href="#定时任务介绍" class="headerlink" title="定时任务介绍"></a>定时任务介绍</h2><p>cron是chronograph的缩写,计时器的意思,crond就是cron daemon,crontab就是cron table</p>
<p>定时任务的使用场景</p>
<ol>
<li>数据备份</li>
<li>服务器巡检</li>
<li>日志切割</li>
<li>临时文件清理</li>
</ol>
<h2 id="定时任务管理"><a href="#定时任务管理" class="headerlink" title="定时任务管理"></a>定时任务管理</h2><p>定时任务日志文件：&#x2F;var&#x2F;log&#x2F;cron</p>
<p>定时任务配置文件：&#x2F;etc&#x2F;crontab</p>
<h3 id="系统级计划任务"><a href="#系统级计划任务" class="headerlink" title="系统级计划任务"></a>系统级计划任务</h3><p>定义方式一：编辑文件&#x2F;etc&#x2F;crontab</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/crontab </span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/crontab </span></span><br><span class="line">SHELL=/<span class="built_in">bin</span>/bash</span><br><span class="line">PATH=/sbin:/<span class="built_in">bin</span>:/usr/sbin:/usr/<span class="built_in">bin</span></span><br><span class="line">MAILTO=root</span><br><span class="line"> </span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br><span class="line"><span class="comment"># 分 时 日 月 周	   用户			命令</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>定义方式二：把脚本放到该目录下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/etc/cron.hourly/		<span class="comment"># 系统定时任务每个小时运行这个目录里的内容</span></span><br><span class="line"> </span><br><span class="line">/etc/cron.daily/ 		<span class="comment"># 系统定时任务每天运行这个目录里的内容</span></span><br><span class="line"> </span><br><span class="line">/etc/cron.weekly/ 		<span class="comment"># 系统定时任务每周运行这个目录里的内容</span></span><br><span class="line"> </span><br><span class="line">/etc/cron.monthly/ 		<span class="comment"># 系统定时任务每月运行这个目录里的内容</span></span><br><span class="line"></span><br><span class="line">/etc/cron.deny 			<span class="comment"># 定时任务的黑名单,使用root将需要拒绝的用户加入/etc/cron.deny</span></span><br></pre></td></tr></table></figure>

<h3 id="用户级计划任务"><a href="#用户级计划任务" class="headerlink" title="用户级计划任务"></a>用户级计划任务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">crontab -e                  <span class="comment"># 创建定时任务</span></span><br><span class="line">crontab -l                  <span class="comment"># 查看定时任务</span></span><br><span class="line">crontab -r					<span class="comment"># 删除定时任务</span></span><br><span class="line">crontab -u					<span class="comment"># 指定其他用户</span></span><br></pre></td></tr></table></figure>



<h3 id="计划任务语法格式"><a href="#计划任务语法格式" class="headerlink" title="计划任务语法格式"></a>计划任务语法格式</h3><blockquote>
<p>时间</p>
</blockquote>
<p>crond是按照分钟进行计算的,不支持秒</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 表示任意的(分、时、日、月、周)时间都执行</span><br><span class="line"> </span><br><span class="line">- 表示一个时间范围段, 如<span class="number">5</span>-<span class="number">7</span>点</span><br><span class="line"> </span><br><span class="line">, 表示分隔时段, 如<span class="number">6</span>,<span class="number">0</span>,<span class="number">4</span>表示周六、日、四</span><br><span class="line"> </span><br><span class="line">/<span class="number">1</span> 表示每隔n单位时间, 如*/<span class="number">10</span> 每<span class="number">10</span>分钟</span><br></pre></td></tr></table></figure>

<blockquote>
<p>用户</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户为执行该任务的用户，如果不写默认是当前用户，某个用户创建的定时任务都可以在  /var/spool/cron/用户名  中查看</span><br></pre></td></tr></table></figure>

<blockquote>
<p>命令</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在命令中，每个命令和文件最好使用绝对路径</span><br></pre></td></tr></table></figure>



<h2 id="定时任务不执行的可能原因"><a href="#定时任务不执行的可能原因" class="headerlink" title="定时任务不执行的可能原因"></a>定时任务不执行的可能原因</h2><blockquote>
<p>脚本的原因：大多数情况下，我们要相信科学，相信计算机，不是有鬼，就是我们的脚本的问题，这种问题导致crontab不能执行的概率占到 70%以上。因为程序执行到某一步导致crontab终止执行，我就碰到一次在迁移代码的时候将数据库连错了。导致无法访问而死在那里了。</p>
</blockquote>
<blockquote>
<p>执行环境问题，当我们碰到第一情况下，一般都可以通过手动执行程序将问题扼杀在摇篮里，一般情况下高手是不应该犯第一种错误的。问题是当我们 手动执行成功而crontab不能执行的时候，笔者碰到一次就是执行环境的问题，例如相关路径的设置问题。解决方案：在代码最前面执行 source &#x2F;home&#x2F;user&#x2F;.bash_profile</p>
</blockquote>
<blockquote>
<p>系统时间不正确。这种问题最好理解，也是比较常见和隐蔽的问题，解决方案：<code>date -s ********</code></p>
</blockquote>
<blockquote>
<p>就是我们的脚本是否有可执行权限。必须保证执行脚本的用户有执行改文件的权限。</p>
</blockquote>
<blockquote>
<p>crond没有启动：<code>systemctl start crond</code></p>
</blockquote>
<blockquote>
<p>crontab不执行的问题困扰了好长时间，脚本写的都正确，但是就是不执行，最终解决方法如下：<code>crontab -u root /var/spool/cron/root</code><br>这样root用户的crontab就生效了，再重启下服务就好了：<code>systemctl restart crond</code></p>
</blockquote>
<blockquote>
<p>脚本编码问题，脚本在window下编写，传到linux下后报“锘?!&#x2F;bin&#x2F;bash”，用vi编辑器新建新shell脚本，输入内容后保存。</p>
</blockquote>
<blockquote>
<p>“ * * * * * tar czf &#x2F;tmp&#x2F;<code>date &#39;+%Y&#39;</code> &#x2F;etc “ 该计划任务中命令的执行流程是crond-&gt;tar命令，而crond在执行tar命令时，无法识别通配符%的意思（shell能识别），所以该命令无法正常执行。改正结果：* * * * * tar czf &#x2F;tmp&#x2F;<code>date &#39;+\%Y&#39;</code> &#x2F;etc    通常都会把要执行的操作放到文件中，然后&#x2F;bin&#x2F;bash a.sh去执行，* * * * * &#x2F;bin&#x2F;bash a.sh  ，这样的执行流程就变成了crond-&gt;bash shell-&gt;a.sh,这样a.sh内即便是写%号，也能被识别出来</p>
</blockquote>
</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-09-20</span>
            
                <span>该篇文章被 邓胖胖</span>
            
            
                <span>打上标签:
                    
                    
                        <a href='/tags/Linux/'>
                            Linux
                        </a>
                    
                </span>
             
             
                <span>归为分类:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            学习笔记
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>上一篇：<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">上一篇：<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--这是指一条线往下的内容-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--目录-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--回到顶部按钮-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- 回到顶部的按钮-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- 返回的按钮-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>