<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Linux网络管理" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--注意：首页既不是post也不是page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--返回顶部css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--目录-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">🍟首页</a></li>
            
        
            
                <li><a href="/list/">📝文章</a></li>
            
        
            
                <li><a href="/tags/">🏷️标签</a></li>
            
        
            
                <li><a href="/categories/">🗂️分类</a></li>
            
        
            
                <li><a href="/about/">👁️关于</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--说明是文章post页面-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Linux网络管理
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86"><span class="post-toc-text">网络管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="post-toc-text">网卡配置文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9B%B4%E6%94%B9%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0"><span class="post-toc-text">更改网卡名称</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1%EF%BC%9Aifconfig%E5%91%BD%E4%BB%A4"><span class="post-toc-text">查看和配置网卡：ifconfig命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="post-toc-text">基本网络配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%A2%E5%8C%85%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%EF%BC%9Aethtool%E5%91%BD%E4%BB%A4"><span class="post-toc-text">丢包问题解决：ethtool命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86"><span class="post-toc-text">路由管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">路由介绍</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="post-toc-text">路由相关命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B0%B8%E4%B9%85%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="post-toc-text">永久配置路由</span></a></li></ol></li></ol></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h1><h2 id="网卡配置文件"><a href="#网卡配置文件" class="headerlink" title="网卡配置文件"></a>网卡配置文件</h2><p>网卡配置文件：<code>/etc/sysconfig/network-scripts/ifconfig-eth0</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">TYPE=&quot;Ethernet&quot;						# 网卡类型：以太网卡</span><br><span class="line">PROXY_METHOD=&quot;none&quot;	</span><br><span class="line">BROWSER_ONLY=&quot;no&quot;</span><br><span class="line">BOOTPROTO=&quot;dhcp&quot;					# IP获取方式，当前为动态获取IP地址，可配置为&quot;static&quot;，比如：</span><br><span class="line"># BOOTPROTO=&quot;static&quot;</span><br><span class="line"># IPADDR=192.168.110.135</span><br><span class="line"># NETMASK=255.255.255.0</span><br><span class="line"># GATEWAY=192.168.110.0				# 通过 route -n 获取网关地址</span><br><span class="line"># DNS1=192.168.110.0				# 路由器的DNS</span><br><span class="line"># DNS1=8.8.8.8						# 谷歌的DNS，也可以指定其他DNS</span><br><span class="line">DEFROUTE=&quot;yes&quot;</span><br><span class="line">IPV4_FAILURE_FATAL=&quot;no&quot;</span><br><span class="line">IPV6INIT=&quot;yes&quot;</span><br><span class="line">IPV6_AUTOCONF=&quot;yes&quot;</span><br><span class="line">IPV6_DEFROUTE=&quot;yes&quot;</span><br><span class="line">IPV6_FAILURE_FATAL=&quot;no&quot;</span><br><span class="line">IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;</span><br><span class="line">NAME=&quot;eth0&quot;							# 网卡名字</span><br><span class="line">UUID=&quot;4f1b1171-ea20-4dfc-b52e-d6f74dc00c1e&quot;		# UUID，每个设备都不一样</span><br><span class="line">DEVICE=&quot;eth0&quot;						# 设备名称</span><br><span class="line">ONBOOT=&quot;yes&quot;						# 随着网络服务启动而激活</span><br><span class="line"># NM_CONTROLLED=no          		# 如果NetworkManager服务启用，该网卡配置文件也不受该服务管理</span><br></pre></td></tr></table></figure>

<p>关于NetworkManager服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NetworkManager是redhat6自带的检测网络、自动连接网络的图形化工具。NetworkManager 服务会干扰网络配置，如：DNS经常会被刷掉,所以通常关闭.</span><br><span class="line"></span><br><span class="line">systemctl stop NetworkManager</span><br><span class="line">systemctl disable NetworkManager</span><br></pre></td></tr></table></figure>

<h2 id="更改网卡名称"><a href="#更改网卡名称" class="headerlink" title="更改网卡名称"></a>更改网卡名称</h2><p>Linux 操作系统的网卡设备的传统命名方式是 eth0、eth1、eth2等，而 CentOS 7 提供了不同的命名规则，默认是基于固件、拓扑、位置信息来分配。这样做的优点是命名全自动的、可预知的，缺点是比 eth0、wlan0 更难读，比如 ens33 。但是真实的情况是我们在做一些操作的时候，往往需要进行批量处理，如果说每台主机的网卡名都是一样的，这就给我们提供了很大的便利，我们可以进行批处理操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#修改网卡配置文件</span><br><span class="line">cd /etc/sysconfig/network-scripts/			# 进入网卡配置文件的目录</span><br><span class="line">sed -i &quot;s#ens33#eth0#g&quot; ifcfg-eth0			# 把网卡配置文件设备名称和网卡名字都从 ens33 改成 eth0 </span><br><span class="line">mv ifcfg-ens33 ifcfg-eth0					# 再把配置文件改名</span><br><span class="line"></span><br><span class="line">#GRUB添加kernel参数，让之后新加的网卡都采用传统命名方式</span><br><span class="line">vim /etc/sysconfig/grub						# 编辑grub文件</span><br><span class="line">GRUB_CMDLINE_LINUX=&quot;rhgb quiet &#x27;net.ifnames=0 biosdevname=0&#x27;&quot;</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg		# 加载到引导分区</span><br><span class="line"> </span><br><span class="line">#重启系统生效</span><br><span class="line">reboot 0</span><br></pre></td></tr></table></figure>

<p>更改MTU</p>
<p>网卡绑定</p>
<h2 id="查看和配置网卡：ifconfig命令"><a href="#查看和配置网卡：ifconfig命令" class="headerlink" title="查看和配置网卡：ifconfig命令"></a>查看和配置网卡：ifconfig命令</h2><p> <code>ifconfig</code> 是Linux中用于显示或配置网络设备的命令，英文全称是network interfaces configuring。它用于查看、配置、启用或禁用位于内核中的网络接口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools -y			# 安装软件包才能使用命令</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ifconfig显示信息解释</p>
<p><a target="_blank" rel="noopener" href="http://rz7v85ras.hd-bkt.clouddn.com/image-20230918011203737.png" title="image-20230918011203737" class="gallery-item" style="box-shadow: none;"> <img src="http://rz7v85ras.hd-bkt.clouddn.com/image-20230918011203737.png" alt="image-20230918011203737"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">         # 从flags可知该接口已启用，支持广播、组播，MTU:1500（最大传输单元）：1500字节</span><br><span class="line"> </span><br><span class="line">        inet 192.168.12.42  netmask 255.255.255.0  broadcast 192.168.12.255</span><br><span class="line">        # IPv4地址           子网掩码               广播地址</span><br><span class="line"> </span><br><span class="line">        inet6 fe80::499e:c2c1:f5ed:3900  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        # IPv6地址                        掩码长度       作用域，link表示仅该接口有效</span><br><span class="line"> </span><br><span class="line">        ether 00:0c:29:86:f8:59  txqueuelen 1000  (Ethernet)</span><br><span class="line">        #网卡接口的MAC地址         传输队列长度       接口类型为Ethernet</span><br><span class="line"> </span><br><span class="line">        RX packets 5708  bytes 1061424 (1.0 MiB)</span><br><span class="line">        # 表示开机后此接口累积接收的报文个数，总字节数</span><br><span class="line"> </span><br><span class="line">        RX errors 0  dropped 833  overruns 0  frame 0</span><br><span class="line">        # 表示开机后此接口累积接收报文错误数，丢弃数，溢出数（由于速度过快而丢失的数据包数），冲突的帧数</span><br><span class="line"> </span><br><span class="line">        TX packets 102  bytes 16768 (16.3 KiB)</span><br><span class="line">        # 表示开机后此接口累积发送的报文个数，总字节数</span><br><span class="line"> </span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        # 表示开机后此接口累积发送报文错误数，丢弃数，溢出数（由于速度过快而丢失的数据包数），</span><br><span class="line">        # carrier 载荷数(发生carrier错误而丢失的数据包数)</span><br><span class="line">        # collisions 冲突数</span><br></pre></td></tr></table></figure>


</li>
<li><p>查看网络接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig					# 查看已经开启的网卡信息</span><br><span class="line">ifconfig -a					# 查看所有网卡设备信息，包含已开启和未开启的</span><br><span class="line">ifconfig [网卡名称]			# 查看单个网卡信息</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭和打开网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [网卡名称] down		# 关闭网卡</span><br><span class="line">ifconfig [网卡名称] up			# 开启网卡</span><br></pre></td></tr></table></figure>
</li>
<li><p>临时配置IP地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [网卡名称] [IP地址] netmask [子网掩码]		# 比如：ifconfig eth0 192.168.110.135 netmask 255.255.255.0</span><br><span class="line"></span><br><span class="line">ifconfig [网卡名称] [IP地址/掩码位]					# 比如 ifconfig eth0 192.168.110.135/24, 与上条命令效果相同</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置mtu(最大传输单元)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [网卡名称] mtu [数值]</span><br><span class="line"># 此条命令是临时设置，如果想每次开机都设置一次，可以将此条命令加到 /etc/rc.local 文件中</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="基本网络配置"><a href="#基本网络配置" class="headerlink" title="基本网络配置"></a>基本网络配置</h2><ul>
<li><p>查看所有网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i eth			# 查看系统的以太网卡，pci是计算机总线接口设备，网卡是其中之一</span><br><span class="line"></span><br><span class="line">mii-tool [网卡名称]			# 查看网卡是否正常连接</span><br><span class="line"></span><br><span class="line">ethtool [网卡名称]			# 查看网卡详细配置信息</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制网络服务开关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl status network			# 查看网络服务运行状态</span><br><span class="line">systemctl start network				# 开启网络服务</span><br><span class="line">systemctl stop network				# 关闭网络服务</span><br><span class="line">systemctl restart network			# 重启网络服务</span><br></pre></td></tr></table></figure>
</li>
<li><p>永久配置IP地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/sysconfig/network-scripts/			<span class="comment"># 进入网卡配置文件的目录</span></span><br><span class="line">cp ifcfg-eth0 ifcfg-eth1					<span class="comment"># 把已存在的网卡配置文件复制一份，改名</span></span><br><span class="line">vim ifcfg-eth1								<span class="comment"># 编辑配置文件，更改网卡名称，IP获取方式，删掉UUID等</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>配置DNS</p>
<p>DNS检索优先级：浏览器DNS缓存-&gt;本地系统DNS缓存-&gt;本地计算机HOSTS文件-&gt;ISP DNS缓存-&gt;递归or迭代搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本地HOST文件</span><br><span class="line">cat /etc/hosts</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DNS配置文件</span><br><span class="line">cat /etc/resolv.conf</span><br></pre></td></tr></table></figure>


</li>
<li><p>修改主机名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostname									# 查看主机名</span><br><span class="line">hostnamectl set-hostname [主机名]				# 通过命令设置主机名</span><br><span class="line">vim /etc/hostname							# 通过配置文件修改主机名</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看服务对应的端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/services</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">常用服务的端口号：</span><br><span class="line">dhcp:67</span><br><span class="line">dns:53</span><br><span class="line">mysql:3306</span><br><span class="line">ssh:22</span><br><span class="line">http:80</span><br><span class="line">http监听端口:8080</span><br><span class="line">https:443</span><br><span class="line">https监听端口:8004</span><br><span class="line">opensvn:1194</span><br><span class="line">redis:6379</span><br><span class="line">zabbix server:10050</span><br><span class="line">zabbix agent:10051</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="丢包问题解决：ethtool命令"><a href="#丢包问题解决：ethtool命令" class="headerlink" title="丢包问题解决：ethtool命令"></a>丢包问题解决：ethtool命令</h2><blockquote>
<p>网卡工作原理</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">网卡发包：</span><br><span class="line">    1、ip包+14个字节的mac头变成数据帧frame</span><br><span class="line">    2、frame拷贝到网卡芯片内部的缓冲区，由网卡处理</span><br><span class="line">    3、网卡芯片为frame添加头部同步信息和CRC校验，此时才是真正可以发送的packet，然后发送该packet</span><br><span class="line">网卡收包：</span><br><span class="line">    1、网络包packet到达网卡，网卡先检查包packet的CRC校验，保证其完整性和正确性，然后去掉它的头得到frame</span><br><span class="line">    2、网卡将frame拷贝到网卡内部的FIFO缓冲区</span><br><span class="line">    3、网卡驱动程序产生硬件中断，把frame从网卡拷贝到内存中，接下来就交给内核处理</span><br><span class="line">网卡丢包：</span><br><span class="line">    内核通常需要快速拷贝网络数据包到系统内存,然而网卡上接收网络数据包的缓存大小固定，而且相比系统内存也要小得多。所以上述拷贝动作一旦被延迟，必然造成网卡FIFO缓存溢出 - 进入的数据包占满了网卡的缓存，后续的包只能被丢弃，这也应该就是ifconfig里的overrun的来源。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>丢包问题定位</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.排查硬件，查看网卡工作模式是否正常。网卡工作在数据链路层，数据在链路层会做一些校验，封装成帧。我们可以查看传输是否存在问题，校验是否出错。然后从软件层面，是否因为缓冲区太小丢包。</span><br><span class="line"></span><br><span class="line">#查看mtu是否正常</span><br><span class="line">ifconfig [网卡名称]									# 查看mtu是否正常</span><br><span class="line"></span><br><span class="line">#查看Speed是否和mtu匹配</span><br><span class="line">ethtool [网卡名称] | grep &#x27;Speed|Duplex&#x27;			# 筛选有用信息，Speed查看网卡速度，Duplex查看是全双工还是半双工</span><br><span class="line"></span><br><span class="line">#查看crc错误值</span><br><span class="line">ethtool -S [网卡名称] | grep crc					# -S 表示统计收发包信息，crc代表统计校验错误的数量，crc的值比较大可能是网络质量问题</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2.通过 ifconfig 查看 overruns 是否一直增大，即数据包是否在网卡缓冲区中溢出</span><br><span class="line"></span><br><span class="line">for i in `seq 1 100`; do ifconfig ens33 | grep RX | grep overruns; sleep 1; done</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问题解决</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1. 一般硬件较少出现故障，如果出现可以采用设置mtu,排查网络质量问题等方法</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2. 如果是网卡缓冲区过小可以调整网卡缓冲区</span><br><span class="line"></span><br><span class="line">ethtool -g [网卡名称]			# 查看网卡缓冲区</span><br><span class="line">ethtool -G [网卡名称] rx [缓冲区数值]		# 调整接收缓冲区数值</span><br><span class="line">ethtool -G [网卡名称] tx [缓冲区数值]		# 调整发送缓冲区数值</span><br></pre></td></tr></table></figure>

<h2 id="路由管理"><a href="#路由管理" class="headerlink" title="路由管理"></a>路由管理</h2><h3 id="路由介绍"><a href="#路由介绍" class="headerlink" title="路由介绍"></a>路由介绍</h3><p>路由是分组从源到目的地时，决定端到端的路径，route</p>
<blockquote>
<p><code>route -n</code> 显示结果的解释</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags 		Metric 		Ref    		Use Iface</span><br><span class="line">0.0.0.0         172.19.63.253   0.0.0.0         UG    		100    		0        	0 	eth0</span><br><span class="line">172.19.0.0      0.0.0.0         255.255.192.0   U     		100    		0        	0 	eth0</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line">目的地			  网关			子网掩码		 标志位		跳数</span><br><span class="line">目标地址		 下一跳往哪走						U：在生效up</span><br></pre></td></tr></table></figure>



<blockquote>
<p>一台Linux主机能够被当成路由器的三大前提</p>
</blockquote>
<ol>
<li><p>至少有两块网卡分别连接两个不同的网段</p>
</li>
<li><p>开启路由转发功能：<code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p>
</li>
<li><p>在该Linux主机上添加正确的路由规则&#x2F;策略：通过<code>route</code>命令配置</p>
</li>
</ol>
<blockquote>
<p>Linux中路由分为三种</p>
</blockquote>
<ol>
<li><p>主机路由：掩码位32位，Destination精确到某一台主机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主机路由是直接指明到具体的某台主机怎么走，主机路由也就是所谓的静态路由</span><br></pre></td></tr></table></figure>
</li>
<li><p>网络路由：掩码小于32位，Destination精确到某一个网段的主机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">网络路由是指明到某类网路怎么走</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认路由：掩码通常为0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不走主机路由和网络路由的，全都走默认路由，操作系统上设置的默认路由一般也称为网关</span><br></pre></td></tr></table></figure></li>
</ol>
<p>主机路由的优先级最高，其次是网络路由，最后是默认路由。因为地址越精确，优先级越高，即子网掩码位数越多，优先级越高。在同样子网掩码的情况下，跳数越少，优先级越高。</p>
<h3 id="路由相关命令"><a href="#路由相关命令" class="headerlink" title="路由相关命令"></a>路由相关命令</h3><blockquote>
<p>添加路由</p>
</blockquote>
<p>添加主机路由：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add -host [某台主机的IP地址]/32 dev [网卡名称]					# 比如：route add -host 1.1.1.10/32 dev eth0</span><br></pre></td></tr></table></figure>

<p>添加网络路由：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add -net [某个网段的IP地址]/24 gw dev [网卡名称]		# 比如：route add -net 192.168.110.0/24 gw dev eth0</span><br></pre></td></tr></table></figure>

<p>添加默认路由：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default gw [指定网关]			# 不走前两条路径的都走默认路由，此条命令相当于route add -net 0.0.0.0/0 gw 192.168.0.254</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除路由</p>
</blockquote>
<p>删除主机路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del -host [IP地址]/32				# 根据配置的 [IP地址]/32 来删除，所以这个必须是已存在的路由</span><br></pre></td></tr></table></figure>

<p>删除网络路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del -net [IP地址]/24				# 同样需要是已存在的路由</span><br></pre></td></tr></table></figure>

<p>删除默认路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del default</span><br></pre></td></tr></table></figure>



<h3 id="永久配置路由"><a href="#永久配置路由" class="headerlink" title="永久配置路由"></a>永久配置路由</h3><p>通过route命令配置路由只能暂时生效，如果需要永久生效，以eth0网卡为例，需要增加配置文件<code>vim /etc/sysconfig/network-scripts/route-eth0</code></p>
<p>文件目录是在<code>/etc/sysconfig/network-scripts/</code>,通过vim新增一个配置文件，内容中编辑要添加的路由，格式为：<code>destination via nexthop</code>,比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/route-eth0</span><br><span class="line"></span><br><span class="line">default via 192.168.0.254 dev eth0			# 默认路由，指定网关为 192.168.0.254	</span><br><span class="line">1.1.1.0/24 via 0.0.0.0 dev eth0				# 网络路由，不指定下一跳</span><br><span class="line">2.2.2.2/32 via 0.0.0.0 dev eth0				# 主机路由，不指定下一跳</span><br><span class="line"></span><br><span class="line">wq</span><br></pre></td></tr></table></figure>

<p>然后需要在网卡的配置文件中，更改一些内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /ect/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"></span><br><span class="line">DEFROUTE=&quot;no&quot;						# 这个选项设置为no，表示不使用DHCP默认分配的路由</span><br><span class="line">PEERROUTES=&quot;no&quot;						# 没有此条则增加上，表示覆盖DHCP的路由配置</span><br><span class="line"></span><br><span class="line">wq</span><br></pre></td></tr></table></figure>

</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-09-17</span>
            
                <span>该篇文章被 邓胖胖</span>
            
            
                <span>打上标签:
                    
                    
                        <a href='/tags/Linux/'>
                            Linux
                        </a>
                    
                </span>
             
             
                <span>归为分类:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            学习笔记
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>上一篇：<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">上一篇：<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--这是指一条线往下的内容-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--目录-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--回到顶部按钮-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- 回到顶部的按钮-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- 返回的按钮-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>