<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="LNMPå®è·µ" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">ğŸŸé¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ“æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">ğŸ·ï¸æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">ğŸ—‚ï¸åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">ğŸ‘ï¸å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            LNMPå®è·µ
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="post-toc-text">å®‰è£…è½¯ä»¶åŒ…</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2WordPress"><span class="post-toc-text">å•æœºéƒ¨ç½²WordPress</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%8B%AC%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="post-toc-text">ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%89%A9%E5%B1%95%E5%A4%9A%E5%8F%B0web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="post-toc-text">æ‰©å±•å¤šå°webæœåŠ¡å™¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8B%86%E5%88%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%88%B0%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="post-toc-text">æ‹†åˆ†é™æ€èµ„æºåˆ°ç‹¬ç«‹æœåŠ¡å™¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%9B%86%E6%88%90%E5%A4%87%E4%BB%BD%E6%9C%8D%E5%8A%A1"><span class="post-toc-text">é›†æˆå¤‡ä»½æœåŠ¡</span></a></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><p>å›¾è§£<strong>Linux&#x2F;Nginx&#x2F;MySQL&#x2F;PHP</strong>æ¶æ„æµç¨‹</p>
<p><a href="/../pic/1694653-20190918163700371-396967787.png" title="Nginxæµè¡Œæ¶æ„LNMP" class="gallery-item" style="box-shadow: none;"> <img src="/../pic/1694653-20190918163700371-396967787.png" alt="Nginxæµè¡Œæ¶æ„LNMP"></a></p>
<h2 id="å®‰è£…è½¯ä»¶åŒ…"><a href="#å®‰è£…è½¯ä»¶åŒ…" class="headerlink" title="å®‰è£…è½¯ä»¶åŒ…"></a>å®‰è£…è½¯ä»¶åŒ…</h2><p>ç‰ˆæœ¬ä¿¡æ¯ï¼š</p>
<p>Linuxï¼šCentOS 7.6</p>
<p>Nginxï¼šnginx&#x2F;1.24.0</p>
<p>PHPï¼šPHP 7.1.33</p>
<p>MariaDBï¼š 5.5.68-MariaDB</p>
<blockquote>
<p>å®‰è£…Nginx</p>
</blockquote>
<p>å‚è€ƒ <code>å­¦ä¹ ç¬”è®°â€”â€”Nginxéƒ¨ç½²ç¯‡</code>ï¼Œç¡®ä¿ä¸åŒæœºå™¨çš„Linuxç‰ˆæœ¬å·ä¸€è‡´ï¼Œå®‰è£…çš„Nginxç‰ˆæœ¬ä¸€è‡´ã€‚</p>
<blockquote>
<p>å®‰è£…PHP</p>
</blockquote>
<ul>
<li><p>å®‰è£…PHPçš„ç»„ä»¶yumæº</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm				<span class="comment"># ä¸‹è½½epelæº</span></span><br><span class="line">rpm -Uvh epel-release-latest-7.noarch.rpm												<span class="comment"># å®‰è£…epelæº</span></span><br><span class="line">wget https://mirror.webtatic.com/yum/el7/webtatic-release.rpm --no-check-certificate	<span class="comment"># ä¸‹è½½ç»„ä»¶åº“æº</span></span><br><span class="line">rpm -Uvh webtatic-release.rpm															<span class="comment"># å®‰è£…ç»„ä»¶åº“æº</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…PHPæœåŠ¡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">rpm -e $(rpm -qa | grep php)		<span class="comment"># å¸è½½æ—§ç‰ˆæœ¬çš„PHPåŒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…PHPä»¥åŠæ‰€æœ‰å¼€å‘è°ƒè¯•éœ€è¦çš„ç»„ä»¶</span></span><br><span class="line">yum install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd -y</span><br><span class="line">yum install php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd -y</span><br><span class="line">yum install php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ”¹PHPçš„ç”¨æˆ·ä¸ºwwwï¼Œæ‰¾åˆ°é…ç½®æ–‡ä»¶ /etc/php-fpm.d/www.conf</span></span><br><span class="line">egrep <span class="string">&#x27;^user|^group&#x27;</span> www.conf				<span class="comment"># æŸ¥çœ‹ç”¨æˆ·åå’Œç»„å</span></span><br><span class="line">sed -i <span class="string">&#x27;/^user/c user = www&#x27;</span> www.conf		<span class="comment"># æ›´æ”¹ç”¨æˆ·å</span></span><br><span class="line">sed -i <span class="string">&#x27;/^group/c group = www&#x27;</span> www.conf 	<span class="comment"># æ›´æ”¹ç»„å</span></span><br><span class="line">egrep <span class="string">&#x27;^user|^group&#x27;</span> www.conf				<span class="comment"># æŸ¥çœ‹ç”¨æˆ·åå’Œç»„å</span></span><br><span class="line"></span><br><span class="line">systemctl start php-fpm</span><br><span class="line">systemctl <span class="built_in">enable</span> php-fpm</span><br><span class="line">lsof -i:9000</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>å®‰è£…mariadb</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mariadb-server mariadb -y</span><br></pre></td></tr></table></figure>

<blockquote>
<p>nginxé…ç½®phpè™šæ‹Ÿä¸»æœº</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  blog;</span><br><span class="line">    root /data/blog;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index  index.php default.html;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        <span class="comment"># å°†è¯·æ±‚åæŠ›ç»™9000ç«¯å£çš„phpæœåŠ¡å»è§£æ</span></span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        <span class="comment"># å‘Šè¯‰phpæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦è¢«è§£æçš„æ–‡ä»¶åœ¨å“ªä¸ªç›®å½•ï¼Œæ˜¯å“ªä¸ªæ–‡ä»¶</span></span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">mkdir</span> -p /data/blog</span><br><span class="line"><span class="built_in">cd</span> /data/blog</span><br><span class="line"><span class="built_in">chown</span> -R www.www /data/blog</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim test_mysql.php			<span class="comment"># æ·»åŠ ä¸€ä¸ªæµ‹è¯•mysqlè¿æ¥çš„è„šæœ¬,æ·»åŠ ä»¥ä¸‹å†…å®¹</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">		<span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">		<span class="variable">$password</span> = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">		<span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">		<span class="comment">//æ£€æµ‹è¿æ¥</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="variable">$conn</span>)&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="title function_ invoke__">mysqli_connect_error</span>());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;æ•°æ®åº“è¿æ¥æˆåŠŸ&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨è®¿é—®ï¼š<code>http://blog/test_mysql.php</code></p>
<h2 id="å•æœºéƒ¨ç½²WordPress"><a href="#å•æœºéƒ¨ç½²WordPress" class="headerlink" title="å•æœºéƒ¨ç½²WordPress"></a>å•æœºéƒ¨ç½²WordPress</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…WordPressè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="built_in">cd</span> /server/tools</span><br><span class="line">wget https://cn.wordpress.org/latest-zh_CN.tar.gz	<span class="comment"># ä¸‹è½½å‹ç¼©åŒ…</span></span><br><span class="line">tar xf latest-zh_CN.tar.gz -C /data/blog/			<span class="comment"># è§£å‹</span></span><br><span class="line"><span class="built_in">mv</span> /data/blog/wordpress/* /data/blog/				<span class="comment"># æŠŠå­æ–‡ä»¶æå–åˆ°blogæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line"><span class="built_in">chown</span> -R www.www /data/blog							<span class="comment"># å·¥ä½œä¸­è¿™æ ·å¾ˆå±é™©ï¼Œå…¶å®åªéœ€è¦å°†å…è®¸ä¸Šä¼ çš„æ–‡ä»¶å¤¹æ›´æ”¹å±ä¸»å’Œæ•°ç»„å³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºWordPressçš„ç”¨æˆ·å’Œæ•°æ®åº“</span></span><br><span class="line">create database blog character <span class="built_in">set</span> utf8mb4 collate utf8mb4_unicode_ci;			<span class="comment"># åˆ›å»ºblogæ•°æ®åº“</span></span><br><span class="line">show create database blog;							<span class="comment"># æŸ¥çœ‹åˆ›å»ºä¿¡æ¯</span></span><br><span class="line">grant all privileges on blog.* to <span class="string">&#x27;blog&#x27;</span>@<span class="string">&#x27;192.168.110.%&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;		<span class="comment"># åˆ›å»ºç”¨æˆ·å¯†ç å¹¶æˆæƒï¼Œå±é™©</span></span><br><span class="line"><span class="comment"># ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸èƒ½ç»™æ‰€æœ‰æƒé™ï¼Œåªèƒ½æœ‰å¢åˆ æ”¹æŸ¥çš„æƒé™,å¯ä»¥æ¢ç”¨ä¸‹é¢è¿™å¥</span></span><br><span class="line"><span class="comment"># grant select,insert,update,delete on blog.* to &#x27;blog&#x27;@&#x27;192.168.110.%&#x27; identified by &#x27;123456&#x27;;</span></span><br><span class="line">flush privileges;									<span class="comment"># åˆ·æ–°</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®æµ‹è¯•</span></span><br></pre></td></tr></table></figure>



<h2 id="ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨"><a href="#ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨" class="headerlink" title="ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨"></a>ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨</h2><p>æ•°æ®åº“çš„ç“¶é¢ˆä¸»è¦æ¥æºäºCPUã€ç£ç›˜I&#x2F;Oå’Œå†…å­˜ï¼Œå°†æ•°æ®åº“éƒ¨ç½²åˆ°ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ol>
<li>ç¼“è§£webç½‘ç«™çš„å‹åŠ›</li>
<li>å¢å¼ºæ•°æ®åº“çš„è¯»å†™æ€§èƒ½</li>
<li>æé«˜ç”¨æˆ·è®¿é—®é€Ÿåº¦</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># web01å¤‡ä»½æ•°æ®åº“</span></span><br><span class="line">mysqldump -uroot -p123456 -B -A | gzip &gt; /tmp/bak.sql.gz	<span class="comment"># -B å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“ï¼Œ-A å¯¼å‡ºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨</span></span><br><span class="line">scp /tmp/bak.sql.gz root@192.168.110.143:/tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># db01å®‰è£…æ•°æ®åº“</span></span><br><span class="line">yum install mariadb-server mariadb -y</span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb</span><br><span class="line"><span class="comment"># db01å¯¼å…¥æ•°æ®åº“</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">gzip -d bak.sql.gz			<span class="comment"># è§£å‹</span></span><br><span class="line">mysql &lt; /tmp/bak.sql		<span class="comment"># å¯¼å…¥</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ”¹WordPressçš„é…ç½®æ–‡ä»¶ï¼ˆä¸»è¦æ˜¯åŸŸåï¼‰ï¼Œè°ƒè¯•è®¿é—®</span></span><br></pre></td></tr></table></figure>

<h2 id="æ‰©å±•å¤šå°webæœåŠ¡å™¨"><a href="#æ‰©å±•å¤šå°webæœåŠ¡å™¨" class="headerlink" title="æ‰©å±•å¤šå°webæœåŠ¡å™¨"></a>æ‰©å±•å¤šå°webæœåŠ¡å™¨</h2><p>æŒ‰ç…§ä¹‹å‰çš„æ­¥éª¤ï¼Œå®‰è£…Nginxå’ŒPHP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># web02æœºå™¨</span></span><br><span class="line">scp -rp root@web01:/etc/nginx /etc/			<span class="comment"># æ‹‰å–ä¸€ä¸‹web01çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">scp -rp root@web01:/data/blog /data/		<span class="comment"># æ‹‰å–ä¸€ä¸‹web01çš„äº§å“æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">systemctl restart nginx</span><br><span class="line">systemctl restart php-fpm</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®æµ‹è¯•</span></span><br></pre></td></tr></table></figure>

<h2 id="æ‹†åˆ†é™æ€èµ„æºåˆ°ç‹¬ç«‹æœåŠ¡å™¨"><a href="#æ‹†åˆ†é™æ€èµ„æºåˆ°ç‹¬ç«‹æœåŠ¡å™¨" class="headerlink" title="æ‹†åˆ†é™æ€èµ„æºåˆ°ç‹¬ç«‹æœåŠ¡å™¨"></a>æ‹†åˆ†é™æ€èµ„æºåˆ°ç‹¬ç«‹æœåŠ¡å™¨</h2><p>NFSçš„æ­å»ºæµç¨‹å‚è€ƒ <code>ä¼ ç»Ÿç½‘ç»œå­˜å‚¨â€”â€”NAS</code>ç¯‡</p>
<p>WordPressçš„é™æ€èµ„æºå­˜æ”¾åœ¨<code>/data/blog/wp-content/uploads</code>ç›®å½•ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -rp /data/blog/wp-content/* root@nfs:/data/blog/		<span class="comment"># web01æœåŠ¡å™¨ä¸Šçš„é™æ€èµ„æºè¿ç§»åˆ°NFSæœåŠ¡å™¨ä¸Š</span></span><br><span class="line">mount -t nfs nfs:/data/blog /data/blog/wp-content/uploads/			<span class="comment"># ä¸´æ—¶æŒ‚è½½</span></span><br><span class="line"><span class="built_in">df</span> -Th		<span class="comment"># æŸ¥çœ‹æŒ‚è½½</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæ ·çš„æ“ä½œæ”¾åˆ°web02æœåŠ¡å™¨ä¸Šæ“ä½œ</span></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®æµ‹è¯•</span></span><br></pre></td></tr></table></figure>



<h2 id="é›†æˆå¤‡ä»½æœåŠ¡"><a href="#é›†æˆå¤‡ä»½æœåŠ¡" class="headerlink" title="é›†æˆå¤‡ä»½æœåŠ¡"></a>é›†æˆå¤‡ä»½æœåŠ¡</h2><p>åœ¨web01æœåŠ¡å™¨ä¸Šç¼–å†™è„šæœ¬ï¼Œå®šæ—¶å¤‡ä»½åˆ°backupæœåŠ¡å™¨ä¸Šï¼ˆå› ä¸ºweb01å’Œweb02å†…å®¹ç›¸åŒï¼Œæ‰€ä»¥å¤‡ä»½ä¸€å°å³å¯ï¼‰</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬æœºå¤‡ä»½è·¯å¾„</span></span><br><span class="line">backup=<span class="string">&quot;/backup&quot;</span></span><br><span class="line"><span class="comment"># ä»¥ä¸»æœºIPåœ°å€å‘½åçš„æ–‡ä»¶å¤¹</span></span><br><span class="line">path=<span class="string">&quot;/backup/<span class="subst">$(hostname -i)</span>&quot;</span></span><br><span class="line"><span class="comment"># å¦‚æœä¸å­˜åœ¨æ­¤æ–‡ä»¶å¤¹åˆ™åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">[ -f <span class="variable">$path</span> ] || <span class="built_in">mkdir</span> -p <span class="variable">$path</span></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ˜¯ä¸æ˜¯å‘¨ä¸€</span></span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">date</span> +%w -eq 2)];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">date</span>=<span class="string">&quot;<span class="subst">$(date +%F -d -1day)</span>_week1&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">date</span>=<span class="string">&quot;<span class="subst">$(date +%F -d -1day)</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># è¿›å…¥æ­¤æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line"><span class="comment"># å°†é…ç½®æ–‡ä»¶å’Œè„šæœ¬æ‰“åŒ…è¿›ä¸€ä¸ªå‹ç¼©åŒ…</span></span><br><span class="line">tar -cvhf conf_<span class="variable">$&#123;date&#125;</span>.tar.gz /var/spool/cron/root /server/scripts /etc 2&gt;/dev/null</span><br><span class="line"><span class="comment"># å°†ç«™ç‚¹ç›®å½•æ‰“åŒ…è¿›ä¸€ä¸ªå‹ç¼©åŒ…</span></span><br><span class="line">tar -cvf  www_<span class="variable">$&#123;date&#125;</span>.tar.gz /data --exclude=/data/blog/wp-content  2&gt;/dev/null</span><br><span class="line"><span class="comment"># å°†appæ—¥å¿—æ‰“åŒ…è¿›ä¸€ä¸ªå‹ç¼©åŒ…</span></span><br><span class="line">tar -cvf logs_<span class="variable">$&#123;date&#125;</span>.tar.gz /var/log/nginx 2&gt;/dev/null</span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰æ‰“åŒ…æ–‡ä»¶çš„åŸå§‹æŒ‡çº¹</span></span><br><span class="line">find <span class="variable">$path</span> -<span class="built_in">type</span> f -name <span class="string">&quot;*_<span class="variable">$&#123;date&#125;</span>.tar.gz&quot;</span> | xargs <span class="built_in">md5sum</span> &gt; <span class="variable">$path</span>/$(hostname -i)_fingerprint_<span class="variable">$&#123;date&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="comment"># æ¨é€</span></span><br><span class="line">rsync -avz <span class="variable">$backup</span>/ rsync@backup::backup --password-file=/etc/rsyncd.password</span><br><span class="line"><span class="comment"># åˆ é™¤7å¤©å‰çš„å¤‡ä»½</span></span><br><span class="line">find <span class="variable">$backup</span>/ -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar.gz&quot;</span> -mtime +7 -o -name <span class="string">&quot;*.log&quot;</span> -mtime +7 | xargs <span class="built_in">rm</span> -f</span><br></pre></td></tr></table></figure>

</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-10-29</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« é‚“èƒ–èƒ–</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B/'>
                            æ“ä½œæµç¨‹
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            å­¦ä¹ ç¬”è®°
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>