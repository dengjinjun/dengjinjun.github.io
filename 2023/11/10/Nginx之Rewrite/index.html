<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Nginxä¹‹Rewrite" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">ğŸŸé¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ“æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">ğŸ·ï¸æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">ğŸ—‚ï¸åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">ğŸ‘ï¸å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Nginxä¹‹Rewrite
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="post-toc-text">ç›¸å…³æ¦‚å¿µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BC%AA%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5"><span class="post-toc-text">ä¼ªé™æ€ç½‘é¡µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Rewrite"><span class="post-toc-text">Rewrite</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%9B%B8%E5%85%B3%E9%9C%80%E6%B1%82"><span class="post-toc-text">ç›¸å…³éœ€æ±‚</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#if%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">ifç¤ºä¾‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#set%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">setç¤ºä¾‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#return%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">returnç¤ºä¾‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#rewrite%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">rewriteç¤ºä¾‹</span></a></li></ol></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><h3 id="ä¼ªé™æ€ç½‘é¡µ"><a href="#ä¼ªé™æ€ç½‘é¡µ" class="headerlink" title="ä¼ªé™æ€ç½‘é¡µ"></a>ä¼ªé™æ€ç½‘é¡µ</h3><p>ä¼ªé™æ€å°±æ˜¯é€šè¿‡æŸäº›æŠ€æœ¯ï¼ˆå¦‚rewriteï¼‰æŠŠåŠ¨æ€ç½‘é¡µçš„URLä¼ªè£…æˆé™æ€ç½‘é¡µçš„URLåœ°å€ã€‚ä¼ªé™æ€ç½‘é¡µå®è´¨ä¸Šç”¨æˆ·è®¿é—®çš„è¿˜æ˜¯åŠ¨æ€ç½‘é¡µï¼Œåªä¸è¿‡ç»™ç”¨æˆ·çœ‹èµ·æ¥çš„URLåœ°å€æ—¶ç¬¦åˆé™æ€ç½‘é¡µåœ°å€ç‰¹å¾çš„ï¼Œå› æ­¤ï¼Œç”¨æˆ·å’Œæœç´¢å¼•æ“ä¼šè¯¯ä»¥ä¸ºæ˜¯é™æ€ç½‘é¡µã€‚</p>
<p>ä¼ªé™æ€ç½‘é¡µçš„ç‰¹ç‚¹:</p>
<ol>
<li><p>ä»ç½‘ç«™çš„URLåœ°å€æ¥çœ‹ï¼Œä¼ªé™æ€è¡¨é¢ä¸Šçœ‹èµ·æ¥æ˜¯é™æ€å†…å®¹ï¼ˆå¦‚åœ°å€åç¼€æ˜¯htmlï¼‰,å®è´¨ä¸Šè®¿é—®çš„è¿˜æ˜¯é€šè¿‡rewriteè§„åˆ™é‡å†™URLåœ°å€ä¹‹åçš„åŠ¨æ€ç½‘é¡µã€‚</p>
</li>
<li><p>ä»æ€§èƒ½ä¸Šæ¥è¯´ï¼Œä¼ªé™æ€åŠŸèƒ½ä¸ä½†æ²¡æœ‰æå‡ç½‘ç«™æ€§èƒ½ï¼Œåè€Œä¼šé™ä½ç½‘ç«™çš„æ€§èƒ½ï¼›è¦æé«˜æ€§èƒ½ï¼Œåº”å½“å°½å¯èƒ½å°†åŠ¨æ€ç½‘é¡µè½¬ä¸ºçœŸæ­£çš„é™æ€é¡µé¢ã€‚</p>
</li>
<li><p>ä½†æ˜¯ä»ç”¨æˆ·ä½“éªŒè§’åº¦æ¥çœ‹ï¼Œæ”¹å†™åçš„URLåœ°å€è§„èŒƒç¾è§‚ï¼Œæœ‰åˆ©äºæœç´¢å¼•æ“æŠ“å–ä»¥åŠæå‡ç”¨æˆ·è®¿é—®ä½“éªŒã€‚</p>
</li>
<li><p>ä¼ªé™æ€ç½‘é¡µçš„å®ç°è¿‡ç¨‹ï¼Œä¸€èˆ¬æ˜¯SEOè¿è¡Œäº§å“æå‡ºéœ€æ±‚ï¼Œç”±å¼€å‘å’Œè¿ç»´å…±åŒå®ç°ã€‚</p>
</li>
</ol>
<h3 id="Rewrite"><a href="#Rewrite" class="headerlink" title="Rewrite"></a>Rewrite</h3><p>Rewriteçš„ä¸»è¦åŠŸèƒ½æ˜¯å®ç°å¯¹URLåœ°å€çš„é‡å†™ï¼Œå°±æ˜¯æŠŠä¼ å…¥Webçš„è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–URLã€‚</p>
<p>Rewriteçš„åŠŸèƒ½ï¼š</p>
<ol>
<li>URL Rewriteæœ€å¸¸è§çš„åº”ç”¨æ˜¯URLä¼ªé™æ€åŒ–ï¼Œæ˜¯å°†åŠ¨æ€é¡µé¢æ˜¾ç¤ºä¸ºé™æ€é¡µé¢æ–¹å¼çš„ä¸€ç§æŠ€æœ¯ã€‚æ¯”å¦‚<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://www.123.com/news/index.php?id=123">http://www.123.com/news/index.php?id=123</a> ä½¿ç”¨URLRewrite è½¬æ¢åå¯ä»¥æ˜¾ç¤ºä¸º <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://www.123.com/news/123.html">http://www.123.com/news/123.html</a>ã€‚Rewriteå¯ä»¥è®©æˆ‘ä»¬ç½‘ç«™çš„ç½‘é¡µæ›´å®¹æ˜“è¢«æœç´¢å¼•æ“æ‰€æ”¶å½•ã€‚</li>
<li>ä»å®‰å…¨è§’åº¦ä¸Šè®²ï¼Œå¦‚æœåœ¨URLä¸­æš´éœ²å¤ªå¤šçš„å‚æ•°ï¼Œæ— ç–‘ä¼šé€ æˆä¸€å®šé‡çš„ä¿¡æ¯æ³„æ¼ï¼Œå¯èƒ½ä¼šè¢«ä¸€äº›é»‘å®¢åˆ©ç”¨ï¼Œå¯¹ä½ çš„ç³»ç»Ÿé€ æˆä¸€å®šçš„ç ´åï¼Œæ‰€ä»¥é™æ€åŒ–çš„URLåœ°å€å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥æ›´é«˜çš„å®‰å…¨æ€§ã€‚</li>
<li>å®ç°ç½‘ç«™åœ°å€è·³è½¬ï¼Œä¾‹å¦‚ç”¨æˆ·è®¿é—®360buy.comï¼Œå°†å…¶è·³è½¬åˆ°jd.comã€‚ä¾‹å¦‚å½“ç”¨æˆ·è®¿é—®test.comçš„  80 ç«¯å£æ—¶ï¼Œå°†å…¶è·³è½¬åˆ° 443 ç«¯å£ã€‚</li>
</ol>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>Nginxçš„Rewriteè§„åˆ™éœ€è¦PCREè½¯ä»¶çš„æ”¯æŒï¼Œå³é€šè¿‡Perlå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•è¿›è¡Œè§„åˆ™åŒ¹é…çš„ï¼Œå‰æ–‡åœ¨å®‰è£…Nginxè½¯ä»¶æ—¶å°±å·²ç»å®‰è£…äº†è¿™ä¸ªPCREè½¯ä»¶ï¼Œä»¥åŠè®©Nginxæ”¯æŒRewriteçš„åŠŸèƒ½ï¼Œé»˜è®¤å‚æ•°ç¼–è¯‘Nginxå°±ä¼šå®‰è£…æ”¯æŒRewriteçš„æ¨¡å—ï¼Œä½†æ˜¯ï¼Œä¹Ÿå¿…é¡»è¦PCREè½¯ä»¶çš„æ”¯æŒã€‚</p>
<p>Nginxå®ç°rewriteçš„æ¨¡å—ï¼š<code>Module ngx_http_rewrite_module</code></p>
<p>å®˜æ–¹ç¤ºä¾‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ MSIE) &#123;</span><br><span class="line">    rewrite ^(.*)$ /msie/<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$http_cookie</span> ~* <span class="string">&quot;id=([^;]+)(?:;|$)&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$id</span> <span class="variable">$1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$request_method</span> = POST) &#123;</span><br><span class="line">    <span class="built_in">return</span> 405;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$slow</span>) &#123;</span><br><span class="line">    limit_rate 10k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">    <span class="built_in">return</span> 403;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‹“å±•ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/LiuYanYGZ/p/5903946.html">https://www.cnblogs.com/LiuYanYGZ/p/5903946.html</a></p>
<h2 id="ç›¸å…³éœ€æ±‚"><a href="#ç›¸å…³éœ€æ±‚" class="headerlink" title="ç›¸å…³éœ€æ±‚"></a>ç›¸å…³éœ€æ±‚</h2><h3 id="ifç¤ºä¾‹"><a href="#ifç¤ºä¾‹" class="headerlink" title="ifç¤ºä¾‹"></a>ifç¤ºä¾‹</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	if (condition) &#123; ... &#125;</span><br><span class="line">Default:	â€”</span><br><span class="line">Context:	server, location</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚1ï¼šè¿‡æ»¤è¯·æ±‚nginxçš„URLä¸­åŒ…å«id&#x3D;520çš„è¯·æ±‚ï¼Œè½¬åˆ°172.16.1.7çš„80ç«¯å£å¤„ç†</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.etiantian.org;</span><br><span class="line">	root /data/www;</span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">		proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">		<span class="comment"># å¦‚æœè¯·æ±‚çš„uriå«æœ‰id=520ï¼Œåˆ™æ‰§è¡Œproxy_passçš„åŠ¨ä½œï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸ç®¡</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$request_uri</span> ~* <span class="string">&#x27;id=520&#x27;</span>) &#123;</span><br><span class="line">		proxy_pass http://172.16.1.7:80;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="setç¤ºä¾‹"><a href="#setç¤ºä¾‹" class="headerlink" title="setç¤ºä¾‹"></a>setç¤ºä¾‹</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	set $variable value<span class="comment">;</span></span><br><span class="line">Default:	â€”</span><br><span class="line">Context:	server, location, if</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚2ï¼šå°†ç”¨æˆ·è¯·æ±‚url.etiantian.org.zhè·³è½¬åˆ°url.etiantian.org&#x2F;zhï¼Œå°†ç”¨æˆ·è¯·æ±‚url.etiantian.org.enè·³è½¬åˆ°url.etiantian.org&#x2F;en</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è´Ÿè´£è·³è½¬,è¯·æ±‚ä¸­æ–‡é¡µé¢ä¼šè·³è½¬åˆ°ä¸­æ–‡URLï¼Œè¯·æ±‚è‹±æ–‡é¡µé¢ä¼šè·³è½¬åˆ°è‹±æ–‡URL</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name url.etiantian.org.zh url.etiantian.org.en;</span><br><span class="line">	location / &#123;</span><br><span class="line">		<span class="built_in">set</span> <span class="variable">$lang</span> zh;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$http_host</span> ~* <span class="string">&quot;en&quot;</span>)&#123;</span><br><span class="line">			<span class="built_in">set</span> <span class="variable">$lang</span> en;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="comment"># è¿™ä¸ªè·³è½¬ä¼šæ‰§è¡Œï¼Œlangè¿™ä¸ªå˜é‡æ˜¯ä»€ä¹ˆå–å†³äºç”¨æˆ·è¯·æ±‚çš„æ˜¯ä»€ä¹ˆåŸŸå</span></span><br><span class="line">	rewrite ^/$ http://url.etiantian.org/<span class="variable">$lang</span>/ permanent;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æ­£å¼çš„ç½‘ç«™å†…å®¹</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name url.etiantian.org;</span><br><span class="line">	root /data/www;</span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="returnç¤ºä¾‹"><a href="#returnç¤ºä¾‹" class="headerlink" title="returnç¤ºä¾‹"></a>returnç¤ºä¾‹</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	return code <span class="section">[text]</span><span class="comment">; return code URL; return URL;</span></span><br><span class="line">Default:	â€”</span><br><span class="line">Context:	server, location, if</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚3ï¼šæ ¹æ®è®¿é—®è®¾å¤‡è·³è½¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.etiantian.org;</span><br><span class="line">	root /data/www;</span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;               </span><br><span class="line">        default_type text/html;</span><br><span class="line">        charset utf-8;</span><br><span class="line">        if ($http_user_agent ~* &quot;chrome|MSIE|firefox&quot;) &#123;</span><br><span class="line">		#return 200 &#x27;è¯·æ›´æ¢æµè§ˆå™¨\n&#x27;;</span><br><span class="line">		#return 520;</span><br><span class="line">		return 301 http://www.oldboyedu.com;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="rewriteç¤ºä¾‹"><a href="#rewriteç¤ºä¾‹" class="headerlink" title="rewriteç¤ºä¾‹"></a>rewriteç¤ºä¾‹</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	rewrite regex replacement <span class="section">[flag]</span><span class="comment">;</span></span><br><span class="line">Default:	â€”</span><br><span class="line">Context:	server, location, if</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚3ï¼šå®ç°è®¿é—®<a target="_blank" rel="noopener" href="http://blog.etiantian.orgè·³è½¬åˆ°http//www.etiantian.org/blog/oldboy.html%E3%80%82">http://blog.etiantian.orgè·³è½¬åˆ°http://www.etiantian.org/blog/oldboy.htmlã€‚</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  blog.etiantian.org;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="variable">$http_host</span> ~* <span class="string">&quot;^(.*)\.etiantian\.org$&quot;</span>) &#123; </span><br><span class="line">       <span class="built_in">set</span> <span class="variable">$domain</span> <span class="variable">$1</span>; </span><br><span class="line">       rewrite ^(.*) http://www.etiantian.org/<span class="variable">$domain</span>/oldboy.html <span class="built_in">break</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">          </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.etiantian.org;</span><br><span class="line">	root /data/www;</span><br><span class="line">	location / &#123;</span><br><span class="line">	index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚4ï¼šé˜²ç›—é“¾ï¼Œå‘ç°æœ‰å¤–ç«™è¯·æ±‚æœ¬ç«™çš„å›¾ç‰‡URLï¼Œå°±è¿”å›ä¸€å¼ ç›—é“¾æç¤ºå›¾ç‰‡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.etiantian.org;</span><br><span class="line">	root /data/www;</span><br><span class="line">	charset utf-8;</span><br><span class="line">	default_type text/html;</span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">	location ~* ^.+\.(gif|jpg|png|swf|flv|rar|zip)$ &#123;</span><br><span class="line">		valid_referers none blocked server_names *.etiantian.org etiantian.org;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">			rewrite ^/ http://test.oldboy.com/img/nolink.jpg;</span><br><span class="line">		&#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯ç”¨æ¥æ˜¾ç¤ºæŒ‡å®šè¿”å›çš„ç›—é“¾æç¤ºå›¾ç‰‡</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name test.oldboy.com;</span><br><span class="line">        root /data/test;</span><br><span class="line">        charset utf-8;</span><br><span class="line">        location / &#123;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚5: ç”¨æˆ·é€šè¿‡æ‰‹æœºè®¾å¤‡è®¿é—®<a target="_blank" rel="noopener" href="http://www.etiantian.orgè·³è½¬è‡³/">www.etiantian.orgè·³è½¬è‡³</a> m.etiantian.org </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.etiantian.org;</span><br><span class="line">    root /code;</span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~* <span class="string">&quot;android|phone|iphone&quot;</span>) &#123;</span><br><span class="line">			rewrite ^(.*)$ http://m.etiantian.org permanent;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚6: ç”¨æˆ·é€šè¿‡httpåè®®è¯·æ±‚ï¼Œèƒ½è‡ªåŠ¨è·³è½¬è‡³httpsåè®®</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.etiantian.org;</span><br><span class="line">    rewrite ^(.*)$ https://$http_host<span class="variable">$1</span>;</span><br><span class="line">    <span class="comment">#return 301 https://$http_host$request_uri;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>éœ€æ±‚7: é”™è¯¯é¡µé¢ä¼˜é›…æ˜¾ç¤ºï¼Œå½“è®¿é—®æœåŠ¡å™¨é‡åˆ°403 404 502ç­‰é”™è¯¯æ—¶ï¼Œè‡ªåŠ¨è½¬åˆ°ä¸´æ—¶ç»´æŠ¤çš„é™æ€é¡µ<a target="_blank" rel="noopener" href="https://404.life/">https://404.life/</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name url.etiantian.org;</span><br><span class="line">    root /code;</span><br><span class="line">    charset utf-8;</span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># æ¥æ”¶è¿”å›çš„é”™è¯¯ä¿¡æ¯ï¼Œå®šå‘åˆ°@error_status,æˆ–è€…é‡å®šå‘åˆ°ä¸€ä¸ªç½‘å€</span></span><br><span class="line">	<span class="comment">#error_page 403 404 500 502 @error_status;</span></span><br><span class="line">	error_page 403 404 500 502 http://www.etiantian.org;</span><br><span class="line">	location @error_status &#123;</span><br><span class="line">		rewrite ^(.*)$ /404.html <span class="built_in">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Nginxå…³äºå¦‚ä½•å¤„ç†error pageçš„ä»‹ç»ï¼š<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_core_module.html#error_page">http://nginx.org/en/docs/http/ngx_http_core_module.html#error_page</a></p>
</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-11-10</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« é‚“èƒ–èƒ–</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/Nginx/'>
                            Nginx
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            å­¦ä¹ ç¬”è®°
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>