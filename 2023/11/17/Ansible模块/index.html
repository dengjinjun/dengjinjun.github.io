<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Ansible核心模块（上）" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--注意：首页既不是post也不是page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--返回顶部css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--目录-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">🍟首页</a></li>
            
        
            
                <li><a href="/list/">📝文章</a></li>
            
        
            
                <li><a href="/tags/">🏷️标签</a></li>
            
        
            
                <li><a href="/categories/">🗂️分类</a></li>
            
        
            
                <li><a href="/about/">👁️关于</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--说明是文章post页面-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Ansible核心模块（上）
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#command-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">command 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#shell-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">shell 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#script-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">script 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hostname%E6%A8%A1%E5%9D%97"><span class="post-toc-text">hostname模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#copy-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">copy 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#template%E6%A8%A1%E5%9D%97"><span class="post-toc-text">template模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#fetch-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">fetch 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#file-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">file 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#archive-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">archive 模块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#unarchive-%E6%A8%A1%E5%9D%97"><span class="post-toc-text">unarchive 模块</span></a></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h3 id="command-模块"><a href="#command-模块" class="headerlink" title="command 模块"></a>command 模块</h3><p>在远程主机执行命令，此为默认模块，可忽略-m选项</p>
<p>注意：此命令不支持 <code>$VARNAME  &lt;  &gt;  |  ;  &amp; </code>  等符号，可以用shell模块实现。</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>chdir</strong> path</td>
<td>Change into this directory before running the command.</td>
</tr>
<tr>
<td><strong>removes</strong> path</td>
<td>A filename or (since 2.0) glob pattern. If a matching file exists, this step <strong>will</strong> be run.</td>
</tr>
<tr>
<td><strong>creates</strong> path</td>
<td>A filename or glob pattern. If a matching file already exists, this step <strong>will not</strong> be run.This is checked before <code>[removes]</code></td>
</tr>
<tr>
<td><strong>cmd</strong> string</td>
<td>The command to run.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m command -a &quot;cmd&quot;</code>，<code>-m command </code>默认可以不加。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接运行命令</span></span><br><span class="line">ansible all -a <span class="string">&#x27;hostname&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># chdir参数，切换目录</span></span><br><span class="line">ansible websrvs -a <span class="string">&#x27;chdir=/opt touch b.txt&#x27;</span>  <span class="comment">#先切换目录再创建文件。不指定目录会创建到家目录下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># creates参数，创建文件</span></span><br><span class="line">ansible websrvs -a <span class="string">&#x27;creates=/etc/fstab rm -f /opt/b.txt&#x27;</span>	<span class="comment"># 这个文件存在，所以不执行后面的rm操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># removes参数，移除文件</span></span><br><span class="line">ansible websrvs -a <span class="string">&#x27;removes=/etc/fstab rm -f /opt/b.txt&#x27;</span>	<span class="comment"># 文件存在，所以执行后面的rm操作</span></span><br></pre></td></tr></table></figure>





<h3 id="shell-模块"><a href="#shell-模块" class="headerlink" title="shell 模块"></a>shell 模块</h3><p>和command相似，用shell执行命令</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>executable</strong> path</td>
<td>Change the shell used to execute the command.This expects an absolute path to the executable.</td>
</tr>
<tr>
<td><strong>chdir</strong> path</td>
<td>Change into this directory before running the command.</td>
</tr>
<tr>
<td><strong>creates</strong> path</td>
<td>A filename, when it already exists, this step will <strong>not</strong> be run.</td>
</tr>
<tr>
<td><strong>removes</strong> path</td>
<td>A filename, when it does not exist, this step will <strong>not</strong> be run.</td>
</tr>
<tr>
<td><strong>cmd</strong> string</td>
<td>The command to run followed by optional arguments.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m shell -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接运行命令，支持 $VARNAME &lt;  &gt;  |  ;  &amp;  等符号</span></span><br><span class="line">ansible websrvs -m shell -a <span class="string">&quot;echo <span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line">ansible websrvs -m shell -a <span class="string">&quot;echo hello &gt;/opt/hello.txt&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="script-模块"><a href="#script-模块" class="headerlink" title="script 模块"></a>script 模块</h3><p>在远程主机上运行ansible服务器上的shell脚本或python脚本（无需执行权限）</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>executable</strong> string</td>
<td>Name or path of an executable to invoke the script with.</td>
</tr>
<tr>
<td><strong>chdir</strong> string</td>
<td>Change into this directory on the remote node before running the script.</td>
</tr>
<tr>
<td><strong>creates</strong> string</td>
<td>A filename on the remote node, when it already exists, this step will <strong>not</strong> be run.</td>
</tr>
<tr>
<td><strong>removes</strong> string</td>
<td>A filename on the remote node, when it does not exist, this step will <strong>not</strong> be run.</td>
</tr>
<tr>
<td><strong>cmd</strong> string</td>
<td>Path to the local script to run followed by optional arguments.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m script -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ll /data/test.sh			<span class="comment"># 查看本机脚本信息，无执行权限</span></span><br><span class="line">-rw-r--r-- 1 root root 22 Jul 15 14:17 /data/test.sh	</span><br><span class="line"></span><br><span class="line"><span class="comment"># 远程执行</span></span><br><span class="line">ansible websrvs -m script -a <span class="string">&#x27;/data/test.sh&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="hostname模块"><a href="#hostname模块" class="headerlink" title="hostname模块"></a>hostname模块</h3><p>管理远程主机的主机名</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>name</strong> string &#x2F; （required）</td>
<td>Name of the host.If the value is a fully qualified domain name that does not resolve from the given host, this will cause the module to hang for a few seconds while waiting for the name resolution attempt to timeout.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m hostname -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更改192.168.20.22的主机名为nginx01,/etc/hostname文件内容也被修改</span></span><br><span class="line">ansible 192.168.20.22 -m hostname -a <span class="string">&#x27;name=nginx01&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="copy-模块"><a href="#copy-模块" class="headerlink" title="copy 模块"></a>copy 模块</h3><p>从ansible服务器主控端复制文件到远程主机</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>backup</strong> boolean</td>
<td>Create a backup file including the timestamp information so you can get the original file back if you somehow clobbered it incorrectly. Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>src</strong> path</td>
<td>Local path to a file to copy to the remote server.This can be absolute or relative.<br />If path is a directory, it is copied recursively.<br /> In this case, if path ends with “&#x2F;”, only inside contents of that directory are copied to destination. <br />Otherwise, if it does not end with “&#x2F;”, the directory itself with all contents is copied. <br />This behavior is similar to the <code>rsync</code> command line tool.</td>
</tr>
<tr>
<td><strong>remote_src</strong> boolean</td>
<td>Influence whether <code>[src]</code> needs to be transferred or already is present remotely. Default choice is <code>false</code><br /> If <code>false</code>, it will search for <code>[src]</code> on the controller node.If <code>true</code> it will search for <code>[src]</code> on the managed (remote) node.<br /><code>[remote_src]</code> supports recursive copying as of version 2.8.<br /><code>[remote_src]</code> only works with <code>mode=preserve</code> as of version 2.6. <br />Autodecryption of files does not work when <code>remote_src=yes</code>.</td>
</tr>
<tr>
<td><strong>dest</strong> path &#x2F; （<strong>required</strong>）</td>
<td>Remote absolute path where the file should be copied to.<br />If <code>[src]</code> is a directory, this must be a directory too.<br />If <code>[dest]</code> is not exist and if either <code>[dest]</code> ends with <code>/</code> or <code>[src]</code> is a directory, <code>[dest]</code> is created.<br />If <code>[dest]</code> is a relative path, the starting directory is determined by the remote host.<br />If <code>[src]</code> and <code>[dest]</code> are files, the parent directory of <code>[dest]</code> is not created and the task fails if it does not already exist.</td>
</tr>
<tr>
<td><strong>mode</strong> any</td>
<td>The permissions of the destination file or directory. You must either add a leading zero so that Ansible’s YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>&#39;644&#39;</code> or <code>&#39;1777&#39;</code>) so Ansible receives a string and can do its own conversion from string into number.</td>
</tr>
<tr>
<td><strong>owner</strong> string</td>
<td>Name of the user that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current user unless you are root, in which case it can preserve the previous ownership.Specifying a numeric username will be assumed to be a user ID and not a username. Avoid numeric usernames to avoid this confusion.</td>
</tr>
<tr>
<td><strong>group</strong> string</td>
<td>Name of the group that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current group of the current user unless you are root, in which case it can preserve the previous ownership.</td>
</tr>
<tr>
<td><strong>directory_mode</strong> any</td>
<td>Set the access permissions of newly created directories to the given mode. Permissions on existing directories do not change.See <code>[mode]</code> for the syntax of accepted values.The target system’s defaults determine permissions when this parameter is not set.</td>
</tr>
<tr>
<td><strong>content</strong> string</td>
<td>When used instead of <code>[src]</code>, sets the contents of a file directly to the specified value.<br />Works only when <code>[dest]</code> is a file.<br /> Creates the file if it does not exist.<br />For advanced formatting or if <code>[content]</code> contains a variable, use the <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html#ansible-collections-ansible-builtin-template-module">ansible.builtin.template</a> module.</td>
</tr>
<tr>
<td><strong>follow</strong> boolean</td>
<td>This flag indicates that filesystem links in the destination, if they exist, should be followed. Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>local_follow</strong> boolean</td>
<td>This flag indicates that filesystem links in the source tree, if they exist, should be followed. Default choice is <code>true</code></td>
</tr>
<tr>
<td><strong>force</strong> boolean</td>
<td>Influence whether the remote file must always be replaced. Default choice is <code>true</code><br />If <code>true</code>, the remote file will be replaced when contents are different than the source.<br />If <code>false</code>, the file will only be transferred if the destination does not exist.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m copy -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如目标存在，默认覆盖，此处指定先备份，要有owner用户，否则报错，</span></span><br><span class="line"><span class="comment"># 再次复制，由于test1.sh内容不变，所以根据ansible的幂等性，不会生成备份文件，显示是success而非changed</span></span><br><span class="line"><span class="comment"># 修改test1.sh文件后，再次复制，会生成备份文件，文件名为test2.sh.备份序号.时间戳</span></span><br><span class="line">ansible websrvs -m copy -a <span class="string">&quot;src=/root/test1.sh dest=/tmp/test2.sh owner=wang mode=600 backup=yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定内容，直接生成目标文件；如果目标文件存在，会覆盖其内容；如果目标文件的父目录不存在，会报错</span></span><br><span class="line">ansible websrvs -m copy -a <span class="string">&quot;content=&#x27;test line1\ntest line2&#x27; dest=/opt/test1.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制/etc/sysconfig目录。如果dest是一个不存在的路径且以“/”结尾，或者src是一个目录，则会创建dest目录。</span></span><br><span class="line">ansible websrvs -m copy -a <span class="string">&quot;src=/etc/sysconfig dest=/opt/test/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制/etc/sysconfig下的文件，不包括/etc/sysconfig目录自身，注意/sysconfig后面有/</span></span><br><span class="line">ansible websrvs -m copy -a <span class="string">&quot;src=/etc/sysconfig/ dest=/opt&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="template模块"><a href="#template模块" class="headerlink" title="template模块"></a>template模块</h3><p><code>template</code>模块使用了<a target="_blank" rel="noopener" href="https://leohsiao.com/Python/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E5%BA%8F%E5%88%97%E5%8C%96/Jinja.html"><code>Jinjia2</code></a>模板语言，可以按需求修改配置文件内容来复制模板到被控主机上。</p>
<p>template模块用法和copy模块用法基本一致，它主要用于复制配置文件，不同的是，template模块需要先建立一个使用<code>*.j2</code>为文件后缀的模板文件。</p>
<p>模版中可以使用如下6个变量以及其他自定义的变量：</p>
<ul>
<li><code>ansible_managed</code> - 包含一个字符串，可用于描述模板名称，主机，模板文件的修改时间和所有者的uid</li>
<li><code>template_host</code> - 包含模板机器的节点名称</li>
<li><code>template_uid</code> - 所有者的uid</li>
<li><code>template_path</code> - 模版路径</li>
<li><code>template_fullpath</code> - 模版的绝对路径</li>
<li><code>template_run_date</code> - 模版呈现的时间</li>
</ul>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>backup</strong> boolean</td>
<td>Create a backup file including the timestamp information so you can get the original file back if you somehow clobbered it incorrectly. Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>block_start_string</strong> string</td>
<td>The string marking the beginning of a block.<strong>Default:</strong> <code>&quot;&#123;%"` |
| **block_end_string** string                      | The string marking the end of a block.**Default:** `"%&#125;&quot;</code></td>
</tr>
<tr>
<td><strong>variable_start_string</strong> string</td>
<td>The string marking the beginning of a print statement.<strong>Default:</strong> <code>&quot;&#123;&#123;"` |
| **variable_end_string** string                   | The string marking the end of a print statement.**Default:** `"&#125;&#125;&quot;</code></td>
</tr>
<tr>
<td><strong>comment_end_string</strong> string</td>
<td>The string marking the end of a comment statement.  added in ansible-core 2.12</td>
</tr>
<tr>
<td><strong>comment_start_string</strong> string</td>
<td>The string marking the beginning of a comment statement.  added in ansible-core 2.12</td>
</tr>
<tr>
<td><strong>lstrip_blocks</strong> boolean</td>
<td>Determine when leading spaces and tabs should be stripped.When set to <code>yes</code> leading spaces and tabs are stripped from the start of a line to a block. Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>trim_blocks</strong> boolean</td>
<td>Determine when newlines should be removed from blocks.When set to <code>yes</code> the first newline after a block is removed (block, not variable tag!).  Default choice is <code>true</code></td>
</tr>
<tr>
<td><strong>newline_sequence</strong> string</td>
<td>Specify the newline sequence to use for templating files.<strong>Choices:</strong><code>&quot;\n&quot;</code> ← (default) or <code>&quot;\r&quot;</code>，<code>&quot;\r\n&quot;</code></td>
</tr>
<tr>
<td><strong>output_encoding</strong> string<em>added in Ansible 2.7</em></td>
<td>Overrides the encoding used to write the template file defined by <code>[dest]</code>. It defaults to <code>utf-8</code>, but any encoding supported by python can be used.The source template file must always be encoded using <code>utf-8</code>.</td>
</tr>
<tr>
<td><strong>dest</strong> path &#x2F; （required）</td>
<td>Location to render the template to on the remote machine.</td>
</tr>
<tr>
<td><strong>src</strong> path &#x2F; required</td>
<td>Path of a Jinja2 formatted template on the Ansible controller.This can be a relative or an absolute path.The file must be encoded with <code>utf-8</code> but <code>[output_encoding]</code> can be used to control the encoding of the output template.</td>
</tr>
<tr>
<td><strong>mode</strong> any</td>
<td>The permissions of the destination file or directory. You must either add a leading zero so that Ansible’s YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>&#39;644&#39;</code> or <code>&#39;1777&#39;</code>) so Ansible receives a string and can do its own conversion from string into number.</td>
</tr>
<tr>
<td><strong>owner</strong> string</td>
<td>Name of the user that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current user unless you are root, in which case it can preserve the previous ownership.Specifying a numeric username will be assumed to be a user ID and not a username. Avoid numeric usernames to avoid this confusion.</td>
</tr>
<tr>
<td><strong>group</strong> string</td>
<td>Name of the group that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current group of the current user unless you are root, in which case it can preserve the previous ownership.</td>
</tr>
<tr>
<td><strong>follow</strong> boolean</td>
<td>This flag indicates that filesystem links in the destination, if they exist, should be followed. Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>force</strong> boolean</td>
<td>Influence whether the remote file must always be replaced. Default choice is <code>true</code><br />If <code>true</code>, the remote file will be replaced when contents are different than the source.<br />If <code>false</code>, the file will only be transferred if the destination does not exist.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m template -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 与copy模块大致相同</span></span><br><span class="line">ansible websrvs -m template -a <span class="string">&quot;src=/root/test1.txt.j2 dest=/tmp/test2.txt backup=yes&quot;</span></span><br></pre></td></tr></table></figure>







<h3 id="fetch-模块"><a href="#fetch-模块" class="headerlink" title="fetch 模块"></a>fetch 模块</h3><p>从远程主机提取文件至ansible的主控端，与copy相反。Fetch目前不支持目录。</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>dest</strong> string &#x2F; (required)</td>
<td>A directory to save the file into.For example, if the <code>[dest]</code> directory is <code>/backup</code>.  a <code>[src]</code> file named <code>/etc/profile</code> on host <code>host.example.com</code>, would be saved into <code>/backup/host.example.com/etc/profile</code>. The host name is based on the inventory name.</td>
</tr>
<tr>
<td><strong>src</strong> string &#x2F; (required)</td>
<td>The file on the remote system to fetch.This <em>must</em> be a file, not a directory.Recursive fetching may be supported in a later release.</td>
</tr>
<tr>
<td><strong>fail_on_missing</strong> boolean</td>
<td>When set to <code>true</code>, the task will fail if the remote file cannot be read for any reason.Prior to Ansible 2.5, setting this would only fail if the source file was missing.The default was changed to <code>true</code> in Ansible 2.5.<br />Default choice is <code>true</code></td>
</tr>
<tr>
<td><strong>flat</strong> boolean</td>
<td>Allows you to override the default behavior of appending hostname&#x2F;path&#x2F;to&#x2F;file to the destination.<br />If <code>[dest]</code> ends with ‘&#x2F;’, it will use the basename of the source file, similar to the copy module.<br />This can be useful if working with a single host, or if retrieving files that are uniquely named per host.If using multiple hosts with the same filename, the file will be overwritten for each host.<br />Default choice is <code>false</code></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m fetch -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取所有远程主机的文件到当前主控端的/data/os目录下，并按远程主机的ip地址创建各自的目录存放</span></span><br><span class="line">ansible db01 -m fetch -a <span class="string">&quot;src=/opt/22.txt dest=/root/os&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 会创建/data/os目录，并在其目录下创建主机名命名的目录存放文件</span></span><br><span class="line">|root@m01 ~|$ tree /root</span><br><span class="line">/root</span><br><span class="line">├── anaconda-ks.cfg</span><br><span class="line">└── os</span><br><span class="line">    └── db01</span><br><span class="line">        └── opt</span><br><span class="line">            └── 22.txt</span><br></pre></td></tr></table></figure>



<h3 id="file-模块"><a href="#file-模块" class="headerlink" title="file 模块"></a>file 模块</h3><p>文件或目录相关</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>follow</strong> boolean</td>
<td>This flag indicates that filesystem links, if they exist, should be followed.<code>follow=yes</code> and <code>state=link</code> can modify <code>[src]</code> when combined with parameters such as <code>[mode]</code>.<br />Previous to Ansible 2.5, this was <code>false</code> by default. Default choice is <code>true</code></td>
</tr>
<tr>
<td><strong>force</strong> boolean</td>
<td>Force the creation of the symlinks in two cases: <br />the source file does not exist (but will appear later); <br />the destination exists and is a file (so, we need to unlink the <code>[path]</code> file and create symlink to the <code>[src]</code> file in place of it). <br />Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>owner</strong> string</td>
<td>Name of the user that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current user unless you are root, in which case it can preserve the previous ownership.Specifying a numeric username will be assumed to be a user ID and not a username. Avoid numeric usernames to avoid this confusion.</td>
</tr>
<tr>
<td><strong>group</strong> string</td>
<td>Name of the group that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current group of the current user unless you are root, in which case it can preserve the previous ownership.</td>
</tr>
<tr>
<td><strong>mode</strong> any</td>
<td>The permissions of the destination file or directory. You must either add a leading zero so that Ansible’s YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>&#39;644&#39;</code> or <code>&#39;1777&#39;</code>) so Ansible receives a string and can do its own conversion from string into number.</td>
</tr>
<tr>
<td><strong>src</strong> path</td>
<td>Path of the file to link to.This applies only to <code>state=link</code> and <code>state=hard</code>.<br />For <code>state=link</code>, this will also accept a non-existing path.<br />Relative paths are relative to the file being created (<code>[path]</code>) which is how the Unix command <code>ln -s SRC DEST</code> treats relative paths.</td>
</tr>
<tr>
<td><strong>path</strong> aliases: dest, namepath &#x2F; required</td>
<td>Path to the file being managed.</td>
</tr>
<tr>
<td><strong>recurse</strong> boolean</td>
<td>Recursively set the specified file attributes on directory contents.This applies only when <code>[state]</code> is set to <code>directory</code>.<br />Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>state</strong> string</td>
<td>If <code>absent</code>, directories will be recursively deleted, and files or symlinks will be unlinked. <br />If <code>directory</code>, all intermediate subdirectories will be created if they do not exist. Since Ansible 1.7 they will be created with the supplied permissions.<br />If <code>file</code>, with no other options, returns the current state of <code>path</code>.<br />If <code>file</code>, even with other options (such as <code>[mode]</code>), the file will be modified if it exists but will NOT be created if it does not exist. <br />Set to <code>touch</code> or use the <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#ansible-collections-ansible-builtin-copy-module">ansible.builtin.copy</a> or <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html#ansible-collections-ansible-builtin-template-module">ansible.builtin.template</a> module if you want to create the file if it does not exist.<br />If <code>hard</code>, the hard link will be created or changed.<br />If <code>link</code>, the symbolic link will be created or changed.<br />If <code>touch</code> (new in 1.4), an empty file will be created if the file does not exist, while an existing file or directory will receive updated file access and modification times (similar to the way <code>touch</code> works from the command line).Default is the current state of the file if it exists, <code>directory</code> if <code>recurse=yes</code>, or <code>file</code> otherwise.<br /><strong>Choices:</strong><code>&quot;absent&quot;``&quot;directory&quot;``&quot;file&quot;``&quot;hard&quot;``&quot;link&quot;``&quot;touch&quot;</code></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m file -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建空白文件</span></span><br><span class="line">ansible websrvs -m file -a <span class="string">&quot;path=/opt/test.sh state=touch&quot;</span>	</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改文件权限，没有指定用户会失败,修改目录权限时，可以指定 recurse=yes 表示递归修改</span></span><br><span class="line">ansible websrvs -m file -a <span class="string">&quot;path=/opt/test.sh owner=wang mode=755&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line">ansible all -m file -a <span class="string">&quot;path=/data/mysql state=directory owner=mysql group=mysql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用mkdir等Linux命令创建文件或目录，重复创建会报错。使用file命令则不会</span></span><br><span class="line">ansible websrvs -a <span class="string">&quot;mkdir /data/dir2&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件或目录，使用state=absent</span></span><br><span class="line">ansible websrvs -m file -a <span class="string">&quot;path=/data/dir2 state=absent&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">#创建软链接，原文件是在目标主机指定的目录中，否则失败</span></span><br><span class="line">ansible all -m file -a <span class="string">&#x27;src=/data/testfile dest=/data/testfile-link state=link&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="archive-模块"><a href="#archive-模块" class="headerlink" title="archive 模块"></a>archive 模块</h3><p>将远程主机的目标文件或目录打包压缩</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>要压缩的文件或目录</td>
</tr>
<tr>
<td>dest</td>
<td>压缩后的文件</td>
</tr>
<tr>
<td>format</td>
<td>指定打包压缩的类型：bz2、gz、tar、xz、zip</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m unarchive -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将目标主机的/etc/sysconfig文件打包压缩，保存为/opt/sys.tar.bz2</span></span><br><span class="line">ansible websrvs -m archive -a <span class="string">&#x27;path=/etc/sysconfig dest=/opt/sys.tar.bz2 format=bz2 owner=haha mode=0600&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="unarchive-模块"><a href="#unarchive-模块" class="headerlink" title="unarchive 模块"></a>unarchive 模块</h3><p>解包解压缩</p>
<blockquote>
<p><strong>参数</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Parameter</th>
<th align="left">Comments</th>
</tr>
</thead>
<tbody><tr>
<td><strong>copy</strong> boolean</td>
<td align="left">If true, the file is copied from local controller to the managed (remote) node, otherwise, the plugin will look for src archive on the managed machine.<br />当copy&#x3D;yes，拷贝的文件是从ansible主机复制到远程主机上，如果设置为no，会在远程主机上寻找src源文件<br />This option has been deprecated in favor of <code>[remote_src]</code>. Exclusive with <code>[remote_src]</code>.<br />Default choice is <code>true</code></td>
</tr>
<tr>
<td><strong>remote_src</strong> boolean</td>
<td align="left">Set to <code>true</code> to indicate the archived file is already on the remote system and not local to the Ansible controller.<br />设置为 <code>true</code> 表示存档文件已经在远程系统上，而不是在 Ansible 控制器本地<br />Default choice is <code>false</code></td>
</tr>
<tr>
<td><strong>src</strong> path &#x2F; required</td>
<td align="left">If <code>remote_src=no</code> (default), local path to archive file to copy to the target server; can be absolute or relative.<br /> If <code>remote_src=yes</code>, path on the target server to existing archive file to unpack.<br />If <code>remote_src=yes</code> and <code>[src]</code> contains <code>://</code>, the remote machine will download the file from the URL first. (version_added 2.0).</td>
</tr>
<tr>
<td><strong>dest</strong> path &#x2F; （required）</td>
<td align="left">Remote absolute path where the archive should be unpacked.<br />The given path must exist. Base directory is not created by this module.</td>
</tr>
<tr>
<td><strong>creates</strong> path</td>
<td align="left">If the specified absolute path (file or directory) already exists, this step will <strong>not</strong> be run.<br />The specified absolute path (file or directory) must be below the base path given with <code>[dest]</code>.</td>
</tr>
<tr>
<td><strong>exclude</strong> list &#x2F; elements&#x3D;string</td>
<td align="left">List the directory and file entries that you would like to exclude from the unarchive action.<br />Mutually exclusive with <code>[include]</code>.<strong>Default:</strong> <code>[]</code></td>
</tr>
<tr>
<td><strong>include</strong> list &#x2F; elements&#x3D;string<em>added in ansible-core 2.11</em></td>
<td align="left">List of directory and file entries that you would like to extract from the archive. <br />If <code>[include]</code> is not empty, only files listed here will be extracted. <strong>Default:</strong> <code>[]</code></td>
</tr>
<tr>
<td><strong>owner</strong> string</td>
<td align="left">Name of the user that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current user unless you are root, in which case it can preserve the previous ownership.Specifying a numeric username will be assumed to be a user ID and not a username. Avoid numeric usernames to avoid this confusion.</td>
</tr>
<tr>
<td><strong>group</strong> string</td>
<td align="left">Name of the group that should own the filesystem object, as would be fed to <em>chown</em>.When left unspecified, it uses the current group of the current user unless you are root, in which case it can preserve the previous ownership.</td>
</tr>
<tr>
<td><strong>mode</strong> any</td>
<td align="left">The permissions of the destination file or directory. You must either add a leading zero so that Ansible’s YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>&#39;644&#39;</code> or <code>&#39;1777&#39;</code>) so Ansible receives a string and can do its own conversion from string into number.</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ad-hoc</strong></p>
</blockquote>
<p>格式：<code>ansible 主机名 -m unarchive -a &quot;cmd&quot;</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认copy=yes,将管理端的压缩包复制到远程主机上后，解压到指定目录，并设置属主和属组。</span></span><br><span class="line">ansible websrvs -m unarchive -a <span class="string">&#x27;src=sys.tar.gz dest=/opt owner=haha group=bin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置copy=no,将远程主机上的某个压缩包解压缩到指定路径下，</span></span><br><span class="line">ansible websrvs -m unarchive -a <span class="string">&#x27;src=/opt/sys.tar.gz dest=/tmp copy=no mode=0777&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以设置第三方地址</span></span><br><span class="line">ansible all -m unarchive -a <span class="string">&#x27;src=https://example.com/example.zip dest=/data copy=no&#x27;</span></span><br></pre></td></tr></table></figure>


</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-11-17</span>
            
                <span>该篇文章被 邓胖胖</span>
            
            
                <span>打上标签:
                    
                    
                        <a href='/tags/Ansible/'>
                            Ansible
                        </a>
                    
                </span>
             
             
                <span>归为分类:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            学习笔记
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>上一篇：<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">上一篇：<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--这是指一条线往下的内容-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--目录-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--回到顶部按钮-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- 回到顶部的按钮-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- 返回的按钮-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>