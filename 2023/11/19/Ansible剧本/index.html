<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Ansibleå‰§æœ¬" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">ğŸŸé¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ“æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">ğŸ·ï¸æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">ğŸ—‚ï¸åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">ğŸ‘ï¸å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Ansibleå‰§æœ¬
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Playbooks%E6%A0%B8%E5%BF%83%E5%85%83%E7%B4%A0"><span class="post-toc-text">Playbooksæ ¸å¿ƒå…ƒç´ </span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hosts"><span class="post-toc-text">hosts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#tasks"><span class="post-toc-text">tasks</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#variables"><span class="post-toc-text">variables</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#templates"><span class="post-toc-text">templates</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#handlers"><span class="post-toc-text">handlers</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Ansible-Roles"><span class="post-toc-text">Ansible Roles</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#include"><span class="post-toc-text">include</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#role"><span class="post-toc-text">role</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B"><span class="post-toc-text">è‡ªåŠ¨éƒ¨ç½²æ¡ˆä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#nfs%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B"><span class="post-toc-text">nfséƒ¨ç½²æ¡ˆä¾‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#lnp%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B"><span class="post-toc-text">lnpéƒ¨ç½²æ¡ˆä¾‹</span></a></li></ol></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><p>ä½¿ç”¨ad-hocå‘½ä»¤å¯ä»¥æ‰§è¡Œä¸€äº›ç®€å•çš„ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰æ—¶ä¸€ä¸ªä»»åŠ¡è¿‡äºå¤æ‚ï¼Œéœ€è¦å¤§é‡çš„æ“ä½œæ—¶å€™ï¼Œæ‰§è¡Œçš„ad-hocå‘½ä»¤æ˜¯ä¸é€‚åˆçš„ï¼Œè¿™æ—¶æœ€å¥½ä½¿ç”¨playbookã€‚Ansibleçš„ä»»åŠ¡é…ç½®æ–‡ä»¶è¢«ç§°ä¸ºplaybookï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºâ€œå‰§æœ¬â€ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ‰¹å¤„ç†ä»»åŠ¡ã€‚</p>
<blockquote>
<p><strong>YAMLè¯­è¨€</strong></p>
</blockquote>
<p>Playbooké‡‡ç”¨YAMLè¯­æ³•ç¼–å†™ï¼Œè¯¥è¯­è¨€è¢«å¼€å‘çš„æ—¶å€™ï¼Œå®ƒçš„æ„æ€æ˜¯ï¼šyet another markup language (ä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€)ã€‚è¯¦è§ï¼š<a target="_blank" rel="noopener" href="https://dengjinjun.site/2023/11/20/YAML%E8%AF%AD%E8%A8%80%E6%95%99%E7%A8%8B/">YAMLè¯­è¨€æ•™ç¨‹</a></p>
<p>YAMLè¯­è¨€çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å…·æœ‰å¾ˆå¥½çš„å¯è¯»æ€§ï¼Œæ˜“äºå®ç°</li>
<li>è¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ‰©å±•æ€§å¥½</li>
<li>å’Œè„šæœ¬è¯­è¨€çš„äº¤äº’æ€§å¥½</li>
<li>æœ‰ä¸€ä¸ªä¸€è‡´çš„ä¿¡æ¯æ¨¡å‹</li>
<li>å¯ä»¥åŸºäºæµç¨‹æ¥å¤„ç†</li>
</ul>
<h2 id="Playbooksæ ¸å¿ƒå…ƒç´ "><a href="#Playbooksæ ¸å¿ƒå…ƒç´ " class="headerlink" title="Playbooksæ ¸å¿ƒå…ƒç´ "></a>Playbooksæ ¸å¿ƒå…ƒç´ </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explainhostsï¼šä¸»æœºç»„ï¼›</span><br><span class="line">tasksï¼šä»»åŠ¡åˆ—è¡¨ï¼›</span><br><span class="line">variablesï¼šå˜é‡ï¼Œè®¾ç½®æ–¹å¼æœ‰å››ç§ï¼›</span><br><span class="line">templatesï¼šåŒ…å«äº†æ¨¡æ¿è¯­æ³•çš„æ–‡æœ¬æ–‡ä»¶ï¼›</span><br><span class="line">handlersï¼šç”±ç‰¹å®šæ¡ä»¶è§¦å‘çš„ä»»åŠ¡</span><br></pre></td></tr></table></figure>

<h3 id="hosts"><a href="#hosts" class="headerlink" title="hosts"></a>hosts</h3><p>å¯¹äºplaybookä¸­çš„æ¯ä¸€ä¸ªplayï¼Œä½¿ç”¨hostsé€‰é¡¹å¯ä»¥å®šä¹‰inventoryä¸­è¦æ‰§è¡Œè¿™äº›ä»»åŠ¡çš„ä¸»æœºæˆ–ä¸»æœºç»„ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explain---</span><br><span class="line">    - hosts: centos6,centos7,192.168.100.59			# hostså¤„å¯ä»¥ä½¿ç”¨&quot;,&quot;åˆ†éš”ä¸»æœºæˆ–ä¸»æœºç»„</span><br><span class="line">      tasks: XXXXXX</span><br><span class="line">        - name: run a command</span><br><span class="line">          shell: /bin/date</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æŒ‡å®šä¸»æœºå’Œä¸»æœºç»„çš„æ–¹å¼ï¼š</p>
<ul>
<li><code>all</code>æˆ–<code>*</code>ï¼šè¡¨ç¤ºinventoryä¸­çš„æ‰€æœ‰ä¸»æœºã€‚</li>
<li><code>:</code>ï¼šå–å¹¶é›†ã€‚ä¾‹å¦‚<code>host1:host2:group1</code>è¡¨ç¤º2å°ä¸»æœºåŠ ä¸€ä¸ªä¸»æœºç»„ã€‚</li>
<li><code>:&amp;</code>ï¼šå–äº¤é›†ã€‚ä¾‹å¦‚<code>group1:&amp;group2</code>è¡¨ç¤ºä¸¤ä¸ªä¸»æœºç»„ä¸­éƒ½æœ‰çš„ä¸»æœºã€‚</li>
<li><code>:!</code>ï¼šæ’é™¤ã€‚ä¾‹å¦‚<code>group1:!host1</code>è¡¨ç¤ºgroup1ä¸­æ’é™¤host1ä¸»æœºçš„å‰©ä½™ä¸»æœºã€‚</li>
<li><code>é€šé…ç¬¦</code>ï¼šä¾‹å¦‚<code>web*.baidu.com</code>ã€‚</li>
<li><code>æ•°å­—èŒƒå›´</code>ï¼šä¾‹å¦‚<code>web[0-5].baidu.com</code>ã€‚</li>
<li><code>å­—æ¯èŒƒå›´</code>ï¼šä¾‹å¦‚<code>web[a-d].baidu.com</code>ã€‚</li>
<li><code>æ­£åˆ™è¡¨è¾¾å¼</code></li>
</ul>
<blockquote>
<p><strong>remote_user</strong></p>
</blockquote>
<p>ä½¿ç”¨<code>remote_user</code>æŒ‡å®šåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ·ï¼Œé»˜è®¤<code>remote_user</code>æ˜¯sshè¿æ¥åˆ°è¢«æ§ä¸»æœºä¸Šçš„ç”¨æˆ·ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨æŸä¸ªtaskä¸Šå•ç‹¬å®šä¹‰æ‰§è¡Œè¯¥taskçš„èº«ä»½ï¼Œè¿™å°†è¦†ç›–å…¨å±€çš„å®šä¹‰ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Explain---</span><br><span class="line">    - hosts: centos6,centos7,192.168.100.59</span><br><span class="line">      remote_user: root</span><br><span class="line">      tasks: </span><br><span class="line">        - name: run a command</span><br><span class="line">          shell: /bin/date</span><br><span class="line">        - name: copy a file to /tmp</span><br><span class="line">          copy: src=/etc/fstab dest=/tmp</span><br><span class="line">          remote_user: myuser</span><br></pre></td></tr></table></figure>

<p><code>remote_user</code>å®é™…ä¸Šå¹¶ä¸æ˜¯æ‰§è¡Œä»»åŠ¡çš„ç»å¯¹èº«ä»½ï¼Œå®ƒåªæ˜¯sshè¿æ¥è¿‡å»çš„èº«ä»½ï¼Œå¦‚æœsshè¿æ¥çš„æ˜¯æ™®é€šç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡<code>become</code>æ¥æŒ‡å®š<code>root</code>ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Explain---</span><br><span class="line">    - hosts: centos6,centos7,192.168.100.59</span><br><span class="line">      remote_user: yourname</span><br><span class="line">      tasks: </span><br><span class="line">        - name: copy a file to /tmp</span><br><span class="line">          copy: src=/etc/fstab dest=/tmp</span><br><span class="line">          become: yes</span><br><span class="line">          become_method: sudo</span><br><span class="line">          become_user: root    # æ­¤é¡¹é»˜è®¤å€¼å°±æ˜¯ä¸ºrootï¼Œå¯çœç•¥</span><br></pre></td></tr></table></figure>

<h3 id="tasks"><a href="#tasks" class="headerlink" title="tasks"></a>tasks</h3><p>tasksä¸‹å®šä¹‰çš„æ˜¯ä¸€ç³»åˆ—taskä»»åŠ¡åˆ—è¡¨ï¼Œæ¯”å¦‚è°ƒç”¨å„ä¸ªæ¨¡å—ã€‚è¿™äº›taskæŒ‰é¡ºåºä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªï¼Œç›´åˆ°æ‰€æœ‰è¢«ç­›é€‰å‡ºæ¥çš„ä¸»æœºéƒ½æ‰§è¡Œäº†è¿™ä¸ªtaskä¹‹åæ‰ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªtaskä¸Šè¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚</p>
<p>ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œhostsé€‰é¡¹æ‰€æŒ‡å®šçš„é‚£äº›ä¸»æœºéƒ½ä¼šæ”¶åˆ°ç›¸åŒçš„taskæŒ‡ä»¤ï¼Œä¸´æ—¶ä»»åŠ¡æ–‡ä»¶ä¼šé€šè¿‡sftpå‘é€åˆ°æ‰€æœ‰çš„è¢«æ§ä¸»æœºä¸Šï¼Œæ‰€æœ‰ä¸»æœºæ”¶åˆ°æŒ‡ä»¤åï¼Œansibleä¸»æ§ç«¯ä¼šç­›é€‰æŸäº›ä¸»æœº(å¦‚æœè¿›è¡Œäº†ç­›é€‰)ï¼Œå¹¶é€šè¿‡sshåœ¨è¿œç¨‹æ‰§è¡Œä»»åŠ¡ã€‚å¯¹äºæŸä¸»æœºæ¥è¯´ï¼ŒæŸä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œåç»­çš„æ‰€æœ‰ä»»åŠ¡éƒ½ä¸ä¼šå†å»æ‰§è¡Œã€‚å½“ç„¶ï¼Œè¿™ä¸ä¼šå½±å“å…¶ä»–çš„ä¸»æœºæ‰§è¡Œä»»åŠ¡(é™¤éä¸»æœºçš„ä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–å…³ç³»)ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œansibleä¸­çš„taskæ˜¯å¹‚ç­‰æ€§çš„ï¼Œå¤šæ¬¡æ‰§è¡Œä¸ä¼šå½±å“é‚£äº›æˆåŠŸæ‰§è¡Œè¿‡çš„ä»»åŠ¡ã€‚å¦å¤–å¹‚ç­‰æ€§è¿˜è¡¨ç°åœ¨æ‰§è¡Œå¤±è´¥åå¦‚æœä¿®æ­£äº†playbookå†æ¬¡æ‰§è¡Œï¼Œå°†ä¸ä¼šå½±å“é‚£äº›åŸæœ¬å·²ç»æ‰§è¡ŒæˆåŠŸçš„ä»»åŠ¡ï¼Œå³ä½¿æ˜¯ä¸åŒä¸»æœºä¹Ÿä¸ä¼šå½±å“ã€‚ä»…è¿™æ–¹é¢è€Œè¨€ï¼Œansibleå¯¹äºæ’é”™æ¥è¯´æ˜¯æå…¶å‹å¥½çš„ã€‚å½“ç„¶ï¼ŒæŸäº›ç‰¹æ®Šçš„æ¨¡å—æˆ–è€…ç‰¹æ®Šå®šä¹‰çš„taskå¹¶ä¸ä¸€å®šæ€»æ˜¯å¹‚ç­‰çš„ï¼Œä¾‹å¦‚æœ€ç®€å•çš„ï¼Œæ‰§è¡Œä¸€ä¸ªcommandæˆ–è€…shellæ¨¡å—çš„å‘½ä»¤ï¼Œå®ƒä¼šé‡å¤æ‰§è¡Œã€‚ä½†ä¹Ÿæœ‰åŠæ³•ä½¿å…¶å˜å¾—å¹‚ç­‰ï¼Œä»¥commandå’Œshellæ¨¡å—ä¸ºä¾‹ï¼Œå®ƒä»¬æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šcreateså’Œremovesï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºè¢«æ§ä¸»æœºä¸ŠæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨(ä¸å­˜åœ¨)æ—¶å°±ä¸æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>taskä¸­æœ‰å…¶è¦æ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ action æ˜¯ä½œä¸ºä¸€ä¸ªåˆ—è¡¨æ¥æä¾›çš„ã€‚åœ¨playbookä¸­ï¼Œæ¯è°ƒç”¨çš„ä¸€ä¸ªæ¨¡å—éƒ½ç§°ä¸ºä¸€ä¸ªactionï¼Œå…¶æœ¬è´¨æ˜¯åŠ è½½å¹¶æ‰§è¡Œansibleå¯¹åº”çš„æ¨¡å—ã€‚</p>
<blockquote>
<p><strong>name</strong></p>
</blockquote>
<p>å¯ä»¥ä¸ºæ¯ä¸ªtaskåŠ ä¸Šnameé¡¹ï¼Œä¹Ÿå¯ä»¥ä¸åŠ ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explain# è¿™ä¸ªtaskæœ‰ä¸¤ä¸ªactionï¼Œç¬¬ä¸€ä¸ªactionå®šä¹‰äº†nameè¿›è¡Œæè¿°ï¼Œè°ƒç”¨äº†fileæ¨¡å—ï¼›ç¬¬äºŒä¸ªactionæ²¡æœ‰å®šä¹‰nameï¼Œè°ƒç”¨äº†shellæ¨¡å—</span><br><span class="line">tasks: </span><br><span class="line">    - name: do something to initialize mariadb</span><br><span class="line">      file: path=/mydata/data state=directory owner=mysql group=mysql mode=0755</span><br><span class="line">    - shell: /usr/bin/mysql_install_db --datadir=/mydata/data --user=mysql creates=/mydata/data/ibdata1</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šnameåªæ˜¯ä¸€ç§æè¿°æ€§è¯­å¥ï¼Œå®ƒå¯ä»¥å®šä¹‰åœ¨ä»»ä½•åœ°æ–¹ã€‚</p>
<blockquote>
<p><strong>action</strong></p>
</blockquote>
<p>actionä¸éœ€è¦æ˜¾å¼åœ°å®šä¹‰å‡ºæ¥ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç†è§£æ€§åœ°æ¦‚å¿µï¼Œè¡¨ç¤ºè°ƒç”¨äº†ä¸€ä¸ªæ¨¡å—çš„åŠ¨ä½œï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥ä¼ é€’æ¨¡å—å‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Explain# ä¸‹é¢çš„taskæ˜¯è¦å¯åŠ¨sshæœåŠ¡</span><br><span class="line"></span><br><span class="line"># æ–¹æ³•ä¸€ï¼š å®šä¹‰ä¸ºkey=valueï¼Œç›´æ¥ä¼ é€’å‚æ•°ç»™æ¨¡å—</span><br><span class="line">tasks: </span><br><span class="line">  - service: name=sshd state=started     </span><br><span class="line"></span><br><span class="line"># æ–¹æ³•äºŒï¼š å®šä¹‰ä¸ºkey: valueæ–¹å¼</span><br><span class="line">tasks: </span><br><span class="line">  - service:                            </span><br><span class="line">      name: sshd</span><br><span class="line">      state: started</span><br><span class="line"></span><br><span class="line"># æ–¹æ³•ä¸‰ï¼š ä½¿ç”¨argså†…ç½®å…³é”®å­—ï¼Œç„¶åå®šä¹‰ä¸ºkey: valueæ–¹å¼</span><br><span class="line">tasks: </span><br><span class="line">  - service:                  </span><br><span class="line">    args: </span><br><span class="line">      name: sshd</span><br><span class="line">      state: started</span><br></pre></td></tr></table></figure>

<p><code>ping</code>æ¨¡å—ã€<code>command</code>å’Œ<code>shell</code>æ¨¡å—æ˜¯ä¸éœ€è¦<code>key=value</code>æ ¼å¼çš„ã€‚</p>
<ul>
<li><p>å¯¹äºpingå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥çœç•¥<code>key=value</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tasks: </span><br><span class="line">    - name: ping host</span><br><span class="line">      ping:</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹äºcommandå’Œshellï¼Œåªéœ€è¦ç»™å®šå‘½ä»¤è·¯å¾„å’Œè¦æ¥ä¸Šå»çš„é€‰é¡¹æˆ–å‚æ•°å³å¯ï¼Œä¸”æ— æ³•ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•äºŒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Explaintasks: </span><br><span class="line">    - name: execute command ntpdate</span><br><span class="line">      shell: /usr/sbin/ntpdate ntp1.aliyun.com</span><br><span class="line">      ignore_errors: true		# è¡¨ç¤ºå¿½ç•¥é0çŠ¶æ€ç ç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰æ—¶éœ€è¦è€ƒè™‘</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>æ¡ä»¶åˆ¤æ–­</strong></p>
</blockquote>
<p>åœ¨taskä¸­å¯ä»¥ä½¿ç”¨<code>when</code>è¯­å¥è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œæ˜¯å¦æ‰§è¡Œè¿™æ¡actionã€‚<code>when</code>è¯­å¥ç¬¦åˆJinjaè¯­æ³•ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Explain# é…åˆfactså˜é‡æ ¹æ®centosç‰ˆæœ¬å·åˆ†å‘ä¸åŒçš„é…ç½®æ–‡ä»¶</span><br><span class="line">tasks:</span><br><span class="line">- name: install conf file to centos7</span><br><span class="line">  template: src=files/nginx.conf.c7.j2</span><br><span class="line">  when: ansible_distribution_major_version == &quot;7&quot;</span><br><span class="line">- name: install conf file to centos6</span><br><span class="line">  template: src=files/nginx.conf.c6.j2</span><br><span class="line">  when: ansible_distribution_major_version == &quot;6&quot;</span><br><span class="line">  </span><br><span class="line"># é…åˆregisterå˜é‡æ ¹æ®ä¸Šä¸€æ­¥æ‰§è¡Œç»“æœåˆ¤æ–­ä¸‹ä¸€æ­¥æ˜¯å¦æ‰§è¡Œ</span><br><span class="line">tasks:</span><br><span class="line">- name: Get the list of installed packages</span><br><span class="line">  shell: rpm -qa</span><br><span class="line">  register: installed_packages</span><br><span class="line"></span><br><span class="line">- name: Install a package if it&#x27;s not already installed</span><br><span class="line">  yum:</span><br><span class="line">    name: mypackage</span><br><span class="line">    state: present</span><br><span class="line">  when: &quot;&#x27;mypackage&#x27; not in installed_packages.stdout&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>å¾ªç¯</strong></p>
</blockquote>
<p>å¯¹äºéœ€è¦é‡å¤æ‰§è¡Œçš„actionï¼Œå¯ä»¥ä½¿ç”¨å¾ªç¯æ¥å®ç°ã€‚</p>
<p>å¯¹å¾ªç¯é¡¹çš„å¼•ç”¨ï¼Œå›ºå®šå˜é‡åä¸º<code>item</code>ï¼Œè€Œåï¼Œè¦åœ¨taskä¸­ä½¿ç”¨<code>with_items</code>ç»™å®šè¦å¾ªç¯çš„å…ƒç´ åˆ—è¡¨ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Explain# æ‰¹é‡å®‰è£…è½¯ä»¶</span><br><span class="line">tasks:</span><br><span class="line">- name: unstall web packages</span><br><span class="line">  yum: name=&#123;&#123; item &#125;&#125; state=absent</span><br><span class="line">  with_items:</span><br><span class="line">  - httpd</span><br><span class="line">  - php</span><br><span class="line">  - php-mysql</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æŒ‡å®šçš„å†…å®¹è¾ƒå¤šï¼Œ<code>with_items</code>ä¸­çš„åˆ—è¡¨é¡¹ä¹Ÿæ”¯æŒå­—å…¸çš„å½¢å¼ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Explaintasks:</span><br><span class="line">- name: add some users</span><br><span class="line">  user: name=&#123;&#123; item.name &#125;&#125; group=&#123;&#123; item.group &#125;&#125; state=present</span><br><span class="line">  with_items:</span><br><span class="line">    - &#123; name: &#x27;user11&#x27;, group: &#x27;group11&#x27; &#125;</span><br><span class="line">    - &#123; name: &#x27;user12&#x27;, group: &#x27;group12&#x27; &#125;</span><br><span class="line">    - &#123; name: &#x27;user13&#x27;, group: &#x27;group13&#x27; &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>tag</strong></p>
</blockquote>
<p>å¯ä»¥ä¸ºplaybookä¸­çš„æ¯ä¸ªactionéƒ½æ‰“ä¸Šæ ‡ç­¾ï¼Œæ ‡ç­¾çš„ä¸»è¦ä½œç”¨æ˜¯å¯ä»¥åœ¨ansible-playbookä¸­è®¾ç½®åªæ‰§è¡Œå“ªäº›è¢«æ‰“ä¸Štagçš„ä»»åŠ¡æˆ–å¿½ç•¥è¢«æ‰“ä¸Štagçš„ä»»åŠ¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Explain# ç»™å¯åŠ¨apacheçš„ä»»åŠ¡æ‰“ä¸Šäº†apacheæ ‡ç­¾ï¼Œç»™å¯åŠ¨mysqlçš„ä»»åŠ¡æ‰“ä¸Šäº†mysqlæ ‡ç­¾</span><br><span class="line">tasks: </span><br><span class="line">   - name: make sure apache is running</span><br><span class="line">     service: name=httpd state=started</span><br><span class="line">     tags: apache</span><br><span class="line">   - name: make sure mysql is running</span><br><span class="line">     service: name=mysqld state=started</span><br><span class="line">     tags: mysql</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå‰§æœ¬æ—¶å¯ä»¥æ ¹æ®tagæ¥é€‰æ‹©æ‰§è¡Œçš„actionï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i hosts -t mysql test.yml 		# åªæ‰§è¡Œå¯åŠ¨mysqlçš„ä»»åŠ¡</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–tagç›¸å…³çš„é€‰é¡¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--list-tags           	# æ˜¾ç¤ºå‰§æœ¬ä¸­æ‰€æœ‰å·²å®šä¹‰çš„æ ‡ç­¾</span><br><span class="line">-t TAGS, --tags=TAGS  	# ä»…æ‰§è¡ŒæŒ‡å®šçš„æ ‡ç­¾</span><br><span class="line">--skip-tags=SKIP_TAGS 	# è·³è¿‡è¿™ä¸ªæ ‡ç­¾ï¼Œæ‰§è¡Œå…¶ä»–æ‰€æœ‰ä»»åŠ¡</span><br></pre></td></tr></table></figure>

<h3 id="variables"><a href="#variables" class="headerlink" title="variables"></a>variables</h3><p>å˜é‡çš„è®¾ç½®æ–¹å¼æœ‰å››ç§</p>
<blockquote>
<p><strong>åœ¨å‰§æœ¬ä¸­ä¹¦å†™å˜é‡</strong></p>
</blockquote>
<ul>
<li><p>å‰§æœ¬ä¸­é€šè¿‡<code>vars</code>æŒ‡å®šå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Explain- hosts: all</span><br><span class="line">  vars:				# æŒ‡å®šå˜é‡ï¼Œä»¥åˆ—è¡¨çš„å½¢å¼</span><br><span class="line">    - name1: nc 	# å˜é‡1</span><br><span class="line">    - name2: nmap 	# å˜é‡2</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‰§æœ¬ä¸­é€šè¿‡<code>vars_files</code>æŒ‡å®šå˜é‡æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  vars_files: vars.yml	# æŒ‡å®šä¸€ä¸ªå˜é‡æ–‡ä»¶ï¼Œå¯è‡ªå®šä¹‰å‘½å</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰§è¡Œå‰§æœ¬æ—¶é€šè¿‡å‘½ä»¤è¡Œä¼ å…¥</p>
<p>é€šè¿‡<code>ansible-playbook</code>å‘½ä»¤çš„å‘½ä»¤è¡Œä¸­çš„<code>-e</code>é€‰é¡¹ï¼Œåé¢è·Ÿ<code>var=xxx</code>ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æŠŠè‡ªå®šä¹‰çš„å˜é‡ä¼ å…¥ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook nginx.yml -e rpmname=keepalived</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰</strong></p>
</blockquote>
<ul>
<li><p>ç›´æ¥åœ¨<code>/etc/ansible/hosts</code>ä¸­å†™å˜é‡ï¼Œä¸å¤ªæ¨èè¿™ç§æ–¹å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explain[webservers]</span><br><span class="line">www[01:50].example.com</span><br><span class="line"> </span><br><span class="line">[webservers:vars]			# å®šä¹‰ç»„å˜é‡ï¼Œç”¨ [ç»„å:vars] è¡¨ç¤º</span><br><span class="line">ansible_ssh_pass=&#x27;root&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ä¸»æœºæ¸…å•æ–‡ä»¶çš„åŒç›®å½•ä¸‹åˆ›å»ºå˜é‡çš„ç›®å½•ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Explain|root@m01 ansible|$ tree -F</span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ ansible.cfg</span><br><span class="line">â”œâ”€â”€ group_vars/			# ç»„å˜é‡ç›®å½•</span><br><span class="line">â”‚   â”œâ”€â”€ db/					# dbç»„å˜é‡ç›®å½•</span><br><span class="line">â”‚   â”‚   â””â”€â”€ vars.yml			# dbç»„å˜é‡æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ web/				# webç»„å˜é‡ç›®å½•</span><br><span class="line">â”‚       â””â”€â”€ vars.yml/			# webç»„å˜é‡æ–‡ä»¶</span><br><span class="line">â””â”€â”€ hosts				# ä¸»æœºæ¸…å•</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>ç›´æ¥è°ƒç”¨factså˜é‡</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Explain#å¸¸ç”¨å¿…å¤‡çš„facts </span><br><span class="line"></span><br><span class="line">ansible_default_ipv4.address 	# é»˜è®¤çš„ç½‘å¡ip eth0</span><br><span class="line">ansible_distribution            # ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬åå­— CentOS  Ubuntu  Debian ...</span><br><span class="line">ansible_memtotal_mb          	# å†…å­˜å¤§å°</span><br><span class="line">ansible_processor_vcpus      	# cpuæ•°é‡ </span><br><span class="line">ansible_processor_cores      	# cpu æ ¸å¿ƒæ•°</span><br><span class="line">ansible_date_time.date   		# æ—¶é—´</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>é€šè¿‡rolesä¼ é€’å˜é‡</strong></p>
</blockquote>
<p>æœ¬æ–‡åç»­è¯¦ç»†è®²è§£</p>
<h3 id="templates"><a href="#templates" class="headerlink" title="templates"></a>templates</h3><p>Templatesæ¨¡æ¿æ˜¯ä¸€ä¸ªåµŒå¥—æœ‰è„šæœ¬çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨<code>Jinja2</code>æ¨¡æ¿ç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼Œå¸¸ç”¨äºå«æœ‰è„šæœ¬æˆ–å˜é‡çš„é…ç½®æ–‡ä»¶çš„ç¼–å†™ï¼Œä»¥<code>.j2</code>ç»“å°¾ã€‚<br>Jinja2æ˜¯pythonçš„ä¸€ç§æ¨¡æ¿è¯­è¨€ï¼Œä»¥Djangoçš„æ¨¡æ¿è¯­è¨€ä¸ºåŸæœ¬ã€‚è¯¦è§ <a target="_blank" rel="noopener" href="https://dengjinjun.site/2023/12/02/Jinja%E8%AF%AD%E8%A8%80%E6%95%99%E7%A8%8B/">Jinjaè¯­è¨€æ•™ç¨‹</a></p>
<h3 id="handlers"><a href="#handlers" class="headerlink" title="handlers"></a>handlers</h3><p>Handlerå¯ä»¥ç†è§£ä¸ºè§¦å‘å™¨ï¼Œéœ€è¦notifyæ¥è§¦å‘ã€‚Handlerä¸»è¦ç”¨äºé‡å¯æœåŠ¡æˆ–è€…è§¦å‘ç³»ç»Ÿé‡å¯ï¼Œé™¤æ­¤ä¹‹å¤–å¾ˆå°‘ä½¿ç”¨Handlerã€‚</p>
<p>ansibleä¸­å‡ ä¹æ‰€æœ‰çš„æ¨¡å—éƒ½å…·æœ‰å¹‚ç­‰æ€§ï¼Œè¿™æ„å‘³ç€è¢«æ§ä¸»æœºçš„çŠ¶æ€æ˜¯å¦å‘ç”Ÿæ”¹å˜æ˜¯èƒ½è¢«æ•æ‰çš„ï¼Œå³æ¯ä¸ªactionçš„changed&#x3D;trueæˆ–changed&#x3D;falseã€‚ansibleåœ¨æ•æ‰åˆ°changed&#x3D;trueæ—¶ï¼Œå¯ä»¥è§¦å‘notifyç»„ä»¶(å¦‚æœå®šä¹‰äº†è¯¥ç»„ä»¶)ã€‚</p>
<p>éœ€è¦åœ¨Handlerä¸­å®šä¹‰ä»»åŠ¡ï¼Œç„¶åå¯ä»¥åœ¨å‰§æœ¬ä¸­ä½¿ç”¨notifyæ¥è§¦å‘handlerä¸­å®šä¹‰çš„actionã€‚notifyæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯è°ƒç”¨handlerã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Explain# è¿™è¡¨ç¤ºå½“æ‰§è¡Œtemplateæ¨¡å—çš„ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ•æ‰åˆ°changed=trueï¼Œå³nginxé…ç½®æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘notifyï¼Œæ‰§è¡Œhandlerä¸­å®šä¹‰çš„start nginx å’Œ test web pageä¸¤ä¸ªaction</span><br><span class="line">tasks: </span><br><span class="line">  - name: copy template file to remote host</span><br><span class="line">    template: src=/etc/ansible/nginx.conf.j2 dest=/etc/nginx/nginx.conf</span><br><span class="line">    notify: </span><br><span class="line">      - restart nginx</span><br><span class="line">      - test web page</span><br><span class="line">handlers: 		# handlersä¸taskså¹³çº§ã€‚å®šä¹‰äº†ä¸¤ä¸ªactionï¼šstart nginx å’Œ test web page</span><br><span class="line">  - name: restart nginx						# actionä¸€å®šè¦å¸¦æœ‰nameæè¿°</span><br><span class="line">    service: name=nginx state=restarted</span><br><span class="line">  - name: test web page						# actionä¸€å®šè¦å¸¦æœ‰nameæè¿°</span><br><span class="line">    shell: curl -I http://192.168.100.10/index.html | grep 200 || /bin/false</span><br></pre></td></tr></table></figure>

<p>å½“ä¸€ä¸ªä»»åŠ¡é€šè¿‡ <code>notify</code> è§¦å‘äº†ä¸€ä¸ªhandlerï¼Œhandlerå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šåœ¨æœ¬æ¬¡playbookçš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼ŒæŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œã€‚è¿™æ„å‘³ç€å½“è§¦å‘äº†å¤šä¸ªhandleræ—¶ï¼Œå®ƒä»¬ä¼šåœ¨å½“å‰å‰§æœ¬çš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®ŒæˆåæŒ‰ç…§å…¶åœ¨å‰§æœ¬ä¸­çš„å®šä¹‰é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>
<p>è¿™ç§è¡Œä¸ºç¡®ä¿äº†åœ¨ä¸€ä¸ªå‰§æœ¬ä¸­æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåå†æ‰§è¡Œä¸€äº›å…±åŒçš„æ“ä½œï¼Œä»è€Œå…è®¸å¯¹å¤šä¸ªä»»åŠ¡çš„ç»“æœè¿›è¡Œæ•´åˆæˆ–è€…åŸºäºè¿™äº›ä»»åŠ¡çš„ç»“æœæ‰§è¡Œå…¶ä»–æ“ä½œã€‚</p>
<h2 id="Ansible-Roles"><a href="#Ansible-Roles" class="headerlink" title="Ansible Roles"></a>Ansible Roles</h2><p>roleæ˜¯ä¸€ç§ansibleå‰§æœ¬ç›®å½•çš„ç¼–æ’æ–¹å¼ï¼Œç›®çš„æ˜¯åˆ†å‰²åºå¤§çš„playbookï¼Œä»¥åŠå¤ç”¨æŸäº›ç»†åŒ–çš„playç”šè‡³æ˜¯taskã€‚</p>
<p>ä»‹ç»roleä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£<code>include</code></p>
<h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><p>å¦‚æœå°†æ‰€æœ‰çš„playéƒ½å†™åœ¨ä¸€ä¸ªplaybookä¸­ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´è¿™ä¸ªplaybookæ–‡ä»¶å˜å¾—è‡ƒè‚¿åºå¤§ï¼Œä¸”ä¸æ˜“è¯»ã€‚å› æ­¤ï¼Œå¯ä»¥å°†å¤šä¸ªä¸åŒä»»åŠ¡åˆ†åˆ«å†™åœ¨ä¸åŒçš„playbookä¸­ï¼Œç„¶åä½¿ç”¨<code>include</code>å°†å…¶åŒ…å«è¿›å»å³å¯ã€‚</p>
<p>includeå¯ä»¥åœ¨ä¸€ä¸ªplaybookä¸­å¯¼å…¥å¦ä¸€ä¸ªplaybookæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ›´ç»†åˆ†åœ°å¯¼å…¥taskæ–‡ä»¶ã€‚</p>
<ul>
<li><p>å¯¼å…¥playbook</p>
<p>åœ¨æ­¤å¤„ï¼Œ<code>include</code>çš„åŠ¨ä½œæ˜¯åœ¨playbookä¸­åŠ è½½ä¸€ä¸ªæˆ–å¤šä¸ªplaybookï¼Œæ‰€ä»¥å†™åœ¨é¡¶çº§åˆ—è¡¨çš„å±‚æ¬¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Explain- name: this is a play at the top level of a file</span><br><span class="line">  hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: say hi</span><br><span class="line">    shell: echo &quot;hi...&quot;</span><br><span class="line"></span><br><span class="line">- include: load_balancers.yml  sayhi=&quot;hello world&quot;</span><br><span class="line">- include: webservers.yml</span><br><span class="line">- include: dbservers.yml</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¼å…¥task</p>
<p>å…ˆç¼–å†™ä¸€ä¸ªtaskæ–‡ä»¶<code>a.yml</code>ï¼Œå…¶å®å°±æ˜¯å¤šä¸ªactionçš„åˆ—è¡¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Explain- name: restart nginx</span><br><span class="line">  service: name=nginx state=restarted</span><br><span class="line">- name: test web page</span><br><span class="line">  shell: curl -I http://192.168.100.10/index.html | grep 200 || /bin/false</span><br></pre></td></tr></table></figure>

<p>playbookä¸­ï¼Œåœ¨tasksæŒ‡ä»¤çš„å­é€‰é¡¹å¤„ä½¿ç”¨includeåŒ…å«ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Explain- hosts: centos7</span><br><span class="line">  tasks:</span><br><span class="line">    - include: a.yml		# åœ¨åŒç›®å½•ä¸­æ‰å¯ä»¥è¿™æ ·å†™ç›¸å¯¹è·¯å¾„</span><br><span class="line">      vars: 				# å¦‚æœa.ymlä¸­å«æœ‰å˜é‡ï¼Œå¯ä»¥åœ¨æ­¤å¤„æ·»åŠ ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨includeè¡Œä¸­æ·»åŠ `var=xxx`</span><br><span class="line">           sayhi: &quot;hi&quot;</span><br></pre></td></tr></table></figure>

<p>handlersä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨includeåŒ…å«</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">handlers:</span><br><span class="line">  - include: a.yml			# åœ¨åŒç›®å½•ä¸­æ‰å¯ä»¥è¿™æ ·å†™ç›¸å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="role"><a href="#role" class="headerlink" title="role"></a>role</h3><p>é€šè¿‡<code>include</code>å¯ä»¥å¯¹è‡ƒè‚¿çš„playbookå®ç°åˆ†å‰²ï¼Œä½†æ˜¯è¿˜å¾ˆéš¾å®ç°çµæ´»åœ°è°ƒç”¨ã€‚</p>
<p>roles ç”¨äºå±‚æ¬¡æ€§ã€ç»“æ„åŒ–åœ°ç»„ç»‡playbookã€‚roles èƒ½å¤Ÿæ ¹æ®å±‚æ¬¡å‹ç»“æ„è‡ªåŠ¨è£…è½½å˜é‡æ–‡ä»¶ã€tasksä»¥åŠhandlersç­‰ã€‚è¦ä½¿ç”¨rolesåªéœ€è¦åœ¨playbookä¸­ä½¿ç”¨includeæŒ‡ä»¤å³å¯ã€‚ç®€å•æ¥è®²ï¼Œroleså°±æ˜¯é€šè¿‡åˆ†åˆ«å°†å˜é‡(vars)ã€æ–‡ä»¶(file)ã€ä»»åŠ¡(tasks)ã€æ¨¡æ¿(templates)åŠè§¦å‘å™¨(handlers)æ”¾ç½®äºå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶å¯ä»¥ä¾¿æ·åœ°includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶ã€‚</p>
<blockquote>
<p><strong>rolesè¦ç´ </strong></p>
</blockquote>
<ul>
<li>default&#x2F;ï¼šæ­¤ç›®å½•ä¸­è‡³å°‘åº”è¯¥æœ‰ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œç”¨äºè®¾å®šé»˜è®¤å˜é‡ï¼›</li>
<li>files&#x2F;ï¼šå­˜å‚¨ç”±copyæˆ–scriptç­‰æ¨¡å—è°ƒç”¨çš„æ–‡ä»¶ï¼›</li>
<li>tasks&#x2F;ï¼šæ­¤ç›®å½•ä¸­è‡³å°‘åº”è¯¥æœ‰ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å„taskï¼›å…¶å®ƒçš„æ–‡ä»¶éœ€è¦ç”±main.ymlè¿›è¡Œâ€œåŒ…å«â€è°ƒç”¨ï¼›</li>
<li>handlers&#x2F;ï¼šæ­¤ç›®å½•ä¸­è‡³å°‘åº”è¯¥æœ‰ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å„handlerï¼›å…¶å®ƒçš„æ–‡ä»¶éœ€è¦ç”±main.ymlè¿›è¡Œâ€œåŒ…å«â€è°ƒç”¨ï¼›</li>
<li>vars&#x2F;ï¼šæ­¤ç›®å½•ä¸­è‡³å°‘åº”è¯¥æœ‰ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å„variableï¼›å…¶å®ƒçš„æ–‡ä»¶éœ€è¦ç”±main.ymlè¿›è¡Œâ€œåŒ…å«â€è°ƒç”¨ï¼›</li>
<li>templates&#x2F;ï¼šå­˜å‚¨ç”±templateæ¨¡å—è°ƒç”¨çš„æ¨¡æ¿æ–‡æœ¬ï¼›</li>
<li>meta&#x2F;ï¼šæ­¤ç›®å½•ä¸­è‡³å°‘åº”è¯¥æœ‰ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»ï¼›å…¶å®ƒçš„æ–‡ä»¶éœ€è¦ç”±main.ymlè¿›è¡Œâ€œåŒ…å«â€è°ƒç”¨ï¼›</li>
</ul>
<blockquote>
<p><strong>ç›®å½•ç»“æ„</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Explain[root@server yaml]# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ site.yml			# å…¥å£æ–‡ä»¶ï¼Œansibleæ‰§è¡Œçš„å‰§æœ¬æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ roles					# rolesç›®å½•ï¼Œæ‰€æœ‰çš„roleéƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸­</span><br><span class="line">    â”œâ”€â”€ httpd					# éƒ¨ç½²apacheæœåŠ¡çš„role</span><br><span class="line">    â”‚   â”œâ”€â”€ default</span><br><span class="line">    â”‚   â”œâ”€â”€ files</span><br><span class="line">    â”‚   â”œâ”€â”€ handlers</span><br><span class="line">    â”‚   â”œâ”€â”€ meta</span><br><span class="line">    â”‚   â”œâ”€â”€ tasks</span><br><span class="line">    â”‚   â”œâ”€â”€ templates</span><br><span class="line">    â”‚   â””â”€â”€ vars</span><br><span class="line">    â”œâ”€â”€ mysql					# éƒ¨ç½²mysqlæœåŠ¡çš„role</span><br><span class="line">    â”‚   â”œâ”€â”€ default</span><br><span class="line">    â”‚   â”œâ”€â”€ files</span><br><span class="line">    â”‚   â”œâ”€â”€ handlers</span><br><span class="line">    â”‚   â”œâ”€â”€ meta</span><br><span class="line">    â”‚   â”œâ”€â”€ tasks</span><br><span class="line">    â”‚   â”œâ”€â”€ templates</span><br><span class="line">    â”‚   â””â”€â”€ vars</span><br><span class="line">    â””â”€â”€ nginx					# éƒ¨ç½²nginxæœåŠ¡çš„role</span><br><span class="line">        â”œâ”€â”€ default</span><br><span class="line">        â”œâ”€â”€ files</span><br><span class="line">        â”œâ”€â”€ handlers</span><br><span class="line">        â”œâ”€â”€ meta</span><br><span class="line">        â”œâ”€â”€ tasks</span><br><span class="line">        â”œâ”€â”€ templates</span><br><span class="line">        â””â”€â”€ vars</span><br></pre></td></tr></table></figure>

<p>Ansibleæœ‰ä¸€ä¸ªç½‘ç«™ä¸“é—¨å­˜æ”¾äº†ä¸€å¤§å †çš„playbookï¼Œå¯ä»¥ä¸‹è½½ä¸‹æ¥ç¨ä½œä¿®æ”¹å°±èƒ½ä½¿ç”¨ï¼š<a target="_blank" rel="noopener" href="https://galaxy.ansible.com/ui/">Ansibleå®˜æ–¹playbookä»“åº“</a></p>
<h2 id="è‡ªåŠ¨éƒ¨ç½²æ¡ˆä¾‹"><a href="#è‡ªåŠ¨éƒ¨ç½²æ¡ˆä¾‹" class="headerlink" title="è‡ªåŠ¨éƒ¨ç½²æ¡ˆä¾‹"></a>è‡ªåŠ¨éƒ¨ç½²æ¡ˆä¾‹</h2><h3 id="nfséƒ¨ç½²æ¡ˆä¾‹"><a href="#nfséƒ¨ç½²æ¡ˆä¾‹" class="headerlink" title="nfséƒ¨ç½²æ¡ˆä¾‹"></a>nfséƒ¨ç½²æ¡ˆä¾‹</h3><p>åœ¨ç›®æ ‡ä¸»æœºä¸Šéƒ¨ç½²nfsæœåŠ¡ï¼Œå¹¶ä¸”æŒ‚è½½åˆ°æœ¬æœºç›®å½•ä¸­</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /scripts/playbook/nfs.yml			<span class="comment"># ç¼–è¾‘å‰§æœ¬ä»»åŠ¡æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>



<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">backup</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nfs</span> <span class="string">rpcbind</span></span><br><span class="line">      <span class="attr">yum:</span>  <span class="string">name=nfs-utils</span> <span class="string">state=installed</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nfs</span> <span class="string">exports</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">dest=/etc/exports</span>   <span class="string">content=&quot;/playbook-backup/</span>  <span class="number">172.16</span><span class="number">.1</span><span class="number">.0</span><span class="string">/24(rw,sync,all_squash)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mkdir</span> <span class="string">chown</span></span><br><span class="line">      <span class="attr">file:</span> <span class="string">path=/playbook-backup</span>  <span class="string">state=directory</span> <span class="string">owner=nfsnobody</span>  <span class="string">group=nfsnobody</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">&amp;&amp;</span> <span class="string">enable</span>  <span class="string">rpc</span></span><br><span class="line">      <span class="attr">systemd:</span>  <span class="string">name=rpcbind</span> <span class="string">enabled=yes</span> <span class="string">state=started</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">&amp;&amp;</span> <span class="string">enable</span>  <span class="string">nfs</span></span><br><span class="line">      <span class="attr">systemd:</span>  <span class="string">name=nfs</span>  <span class="string">enabled=yes</span> <span class="string">state=started</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mount</span> <span class="string">test</span></span><br><span class="line">      <span class="attr">mount:</span> <span class="string">fstype=nfs</span> <span class="string">src=172.16.1.41:/playbook-backup</span>   <span class="string">path=/mnt</span>  <span class="string">state=mounted</span></span><br></pre></td></tr></table></figure>



<h3 id="lnpéƒ¨ç½²æ¡ˆä¾‹"><a href="#lnpéƒ¨ç½²æ¡ˆä¾‹" class="headerlink" title="lnpéƒ¨ç½²æ¡ˆä¾‹"></a>lnpéƒ¨ç½²æ¡ˆä¾‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /scripts/playbook/lnp.yml		<span class="comment"># ç¼–è¾‘å‰§æœ¬ä»»åŠ¡æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">backup</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">nginx</span> <span class="string">repo</span> 		<span class="comment"># æ·»åŠ nginxæº</span></span><br><span class="line">      <span class="attr">yum_repository:</span>  </span><br><span class="line">        <span class="attr">file:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span>  </span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;ngx repo&quot;</span>  </span><br><span class="line">        <span class="attr">baseurl:</span> <span class="string">&quot;http://nginx.org/packages/centos/$releasever/$basearch/&quot;</span>  </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span> </span><br><span class="line">        <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">php</span> <span class="string">repo</span> 		<span class="comment"># æ·»åŠ phpæº</span></span><br><span class="line">      <span class="attr">yum_repository:</span></span><br><span class="line">        <span class="attr">file:</span> <span class="string">php</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">php</span> </span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;php repo&quot;</span> </span><br><span class="line">        <span class="attr">baseurl:</span> <span class="string">&quot;http://us-east.repo.webtatic.com/yum/el7/x86_64/&quot;</span>      </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">no</span> 			<span class="comment"># é»˜è®¤å…³é—­ï¼Œå› ä¸ºè¿™ä¸ªæºåªåœ¨å®‰è£…phpæ—¶ä½¿ç”¨ </span></span><br><span class="line">        <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nginx</span> <span class="string">&amp;&amp;</span> <span class="string">php</span> <span class="string">pack</span> 	<span class="comment"># å®‰è£…nginxå’Œphp</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx,php71w,php71w-cli,php71w-common,php71w-devel,php71w-embedded,php71w-gd,php71w-mcrypt,php71w-mbstring,php71w-pdo,php71w-xml,php71w-fpm,php71w-mysqlnd,php71w-opcache,php71w-pecl-memcached,php71w-pecl-redis,php71w-pecl-mongodb</span></span><br><span class="line">        <span class="attr">enablerepo:</span> <span class="string">php</span>			<span class="comment"># è¿™é‡Œéœ€è¦æ‰“å¼€</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">installed</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">nginx</span> <span class="string">conf</span> 			<span class="comment"># æŠŠnginxé…ç½®æ–‡ä»¶å¤åˆ¶è¿‡å»</span></span><br><span class="line">      <span class="attr">copy:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">nginx-php-www.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d/www.conf</span></span><br><span class="line">        <span class="attr">backup:</span> <span class="literal">yes</span> </span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">php</span> <span class="string">conf</span> 				<span class="comment"># æŠŠphpé…ç½®æ–‡ä»¶å¤åˆ¶è¿‡å»</span></span><br><span class="line">      <span class="attr">copy:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">php-www.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/php-fpm.d/www.conf</span></span><br><span class="line">        <span class="attr">backup:</span> <span class="literal">yes</span>       </span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">code</span>  <span class="string">dir</span> 			<span class="comment"># åˆ›å»ºnginxçš„ç½‘ç«™ç›®å½•</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/data/www-play/</span> </span><br><span class="line">        <span class="attr">owner:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">group:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span> </span><br><span class="line">       </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">code</span>  					<span class="comment"># æŠŠç½‘ç«™é¦–é¡µæ–‡ä»¶å¤åˆ¶è¿‡å»</span></span><br><span class="line">      <span class="attr">copy:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">web-index.php</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/data/www-play/index.php</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">group:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">backup:</span> <span class="literal">yes</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span> 				<span class="comment"># å¯åŠ¨nginx</span></span><br><span class="line">      <span class="attr">systemd:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span> </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span> </span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">php</span>  					<span class="comment"># å¯åŠ¨php</span></span><br><span class="line">      <span class="attr">systemd:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">php-fpm</span>  </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span> </span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span>      </span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬æœºçš„nginxé…ç½®æ–‡ä»¶</span></span><br><span class="line">server  &#123;</span><br><span class="line">   listen 80 default_server;</span><br><span class="line">   server_name www.etiantian.org;</span><br><span class="line">   root /data/www-play;</span><br><span class="line">   location  /  &#123;</span><br><span class="line">   index index.php  index.html;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   location  ~*  \.php$  &#123;</span><br><span class="line">   fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">   fastcgi_index index.php;</span><br><span class="line">   fastcgi_param SCRIPT_FILENAME $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">   include fastcgi_params;	</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬æœºçš„phpé…ç½®æ–‡ä»¶</span></span><br><span class="line">[www]</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx </span><br><span class="line">listen = 127.0.0.1:9000</span><br><span class="line">listen.allowed_clients = 127.0.0.1</span><br><span class="line">pm = dynamic</span><br><span class="line">pm.max_children = 50</span><br><span class="line">pm.start_servers = 5</span><br><span class="line">pm.min_spare_servers = 5</span><br><span class="line">pm.max_spare_servers = 35</span><br><span class="line">slowlog = /var/log/php-fpm/www-slow.log</span><br><span class="line">php_admin_value[error_log] = /var/log/php-fpm/www-error.log</span><br><span class="line">php_admin_flag[log_errors] = on</span><br><span class="line">php_value[soap.wsdl_cache_dir]  = /var/lib/php/wsdlcache</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç½‘ç«™é¦–é¡µæ–‡ä»¶</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-11-19</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« é‚“èƒ–èƒ–</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/Ansible/'>
                            Ansible
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            å­¦ä¹ ç¬”è®°
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>