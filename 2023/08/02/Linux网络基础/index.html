<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Linux网络基础" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--注意：首页既不是post也不是page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--返回顶部css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--目录-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">🍟首页</a></li>
            
        
            
                <li><a href="/list/">📝文章</a></li>
            
        
            
                <li><a href="/tags/">🏷️标签</a></li>
            
        
            
                <li><a href="/categories/">🗂️分类</a></li>
            
        
            
                <li><a href="/about/">👁️关于</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--说明是文章post页面-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Linux网络基础
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#OSI%E6%A8%A1%E5%9E%8B%E5%92%8CTCP-IP%E6%A8%A1%E5%9E%8B"><span class="post-toc-text">OSI模型和TCP&#x2F;IP模型</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%90%84%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="post-toc-text">各层协议</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ARP%E5%8D%8F%E8%AE%AE"><span class="post-toc-text">ARP协议</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TCP%E5%8D%8F%E8%AE%AE"><span class="post-toc-text">TCP协议</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="post-toc-text">三次握手</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="post-toc-text">四次挥手</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#backlog%E5%8D%8A%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="post-toc-text">backlog半连接池</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#TCP%E5%8D%8F%E8%AE%AE%E4%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E7%A7%B0%E4%B8%BA%E5%8F%AF%E9%9D%A0%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="post-toc-text">TCP协议会为什么称为可靠的协议</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DHCP"><span class="post-toc-text">DHCP</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DNS"><span class="post-toc-text">DNS</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81"><span class="post-toc-text">查看网络状态</span></a></li></ol></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="OSI模型和TCP-IP模型"><a href="#OSI模型和TCP-IP模型" class="headerlink" title="OSI模型和TCP&#x2F;IP模型"></a>OSI模型和TCP&#x2F;IP模型</h1><p>OSI模型为七层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。</p>
<p>TCP&#x2F;IP模型根据业务场景将其分为五层或者四层：物理层和数据链路层合并为网络接口层，网络层、传输层、顶端三层合并为应用层。</p>
<p>下面主要以TCP&#x2F;IP模型来介绍：</p>
<blockquote>
<p><strong>应用层：</strong>应用程序自定义的协议，比如http协议，ftp协议等，</p>
</blockquote>
<blockquote>
<p><strong>传输层：</strong>TCP&#x2F;UDP协议，封装为数据段，段头包含源端口和目标端口，端口在本机唯一即可，用来区分一台机器上的不同服务</p>
</blockquote>
<blockquote>
<p><strong>网络层：</strong>IP协议，再次封装为数据包，包头放源IP地址和目标IP地址。规定通过IP地址(网络地址+主机地址)和子网掩码划分局域网。不在同一局域网内的主机必须通过IP地址找到目标主机，在局域网内则通过mac地址找到目标主机。</p>
</blockquote>
<blockquote>
<p><strong>数据链路层：</strong>Ethernet(以太网)协议，要求有网卡，规定一组电信号构成一个数据包，叫做”帧”。一帧包含head（18字节）和data两部分。head部分包含发送者mac地址、接收者mac地址，数据类型三部分。</p>
</blockquote>
<blockquote>
<p><strong>物理层：</strong>	把二进制数据转换为电信号(比特位)</p>
</blockquote>
<p>​						</p>
<p><a href="/../pic/u=1631000585,2783979957&fm=253&fmt=auto&app=138&f=JPEG.jpeg" title="img" class="gallery-item" style="box-shadow: none;"> <img src="/../pic/u=1631000585,2783979957&fm=253&fmt=auto&app=138&f=JPEG.jpeg" alt="img"></a></p>
<h1 id="各层协议"><a href="#各层协议" class="headerlink" title="各层协议"></a>各层协议</h1><p><a href="/../pic/u=1568539936,3419826034&fm=253&fmt=auto&app=138&f=JPEG.jpeg" title="img" class="gallery-item" style="box-shadow: none;"> <img src="/../pic/u=1568539936,3419826034&fm=253&fmt=auto&app=138&f=JPEG.jpeg" alt="img"></a></p>
<h2 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h2><p>ARP协议在网络层工作，用于在一个局域网内通过ip地址获取目标mac。</p>
<p>在局域网内是通过mac地址进行通信的，所以在局域网内发送数据包之前，必须先获取目标主机的mac地址。然后是数据链路层通过mac地址通信。</p>
<p>ARP协议的原理是在局域网内广播一个数据包，局域网内的所有主机都可以收到数据包，通过验证数据包中携带的IP地址，来判断自己是不是接收者，若是，则回复自己的mac地址。	</p>
<pre><code>情况一：同一局域网内的两台主机通信
    计算机1
    192.168.10.11/24
    计算机2
    192.168.10.13/24	

1、拿到目标mac地址
    ARP协议：
        判断两台计算机的子网地址是否一样，如果一样，应该尝试获取计算机2的mac地址
        
    I：计算机1的mac地址 FF-FF-FF-FF-FF-FF 192.168.10.11/24  192.168.10.13/24  数据部分
        
    II：所有计算机都收到该ARP包，
        碰到 FF-FF-FF-FF-FF-FF，大家知道对方想跟自己要mac地址
        如果目标ip：192.168.10.13/24就是自己，那么就返回mac地址
        
2、发真正的数据
    计算机1的mac地址  计算机2的mac地址 192.168.10.11/24 192.168.10.13/24 数据部分


情况二：跨局域网的两台主机通信
    计算机1
    192.168.10.11/24
    计算机2
    202.10.11.13/24
    
1、拿到目标mac地址
    ARP协议：
        判断两台计算机的子网地址如果不一样，应该尝试获取网关的mac地址
    
    I：计算机1的mac地址 FF-FF-FF-FF-FF-FF 192.168.10.11/24  192.168.10.1/24  数据部分
        
    II：所有计算机都收到该ARP包，
        碰到 FF-FF-FF-FF-FF-FF，大家知道对方想跟自己要mac地址
        如果目标ip：192.168.10.1/24就是自己，那么就返回mac地址
        
2、发真正的数据
    计算机1的mac地址  网关的mac地址 192.168.10.11/24 202.10.11.13/24 数据部分
</code></pre>
<p><a target="_blank" rel="noopener" href="https://qny.oss.dengjinjun.site//image-20230805233826613.png" class="gallery-item" style="box-shadow: none;"> <img src="https://qny.oss.dengjinjun.site//image-20230805233826613.png"></a></p>
<p>​		</p>
<h2 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h2><p>TCP连接经过三次握手，断开经过四次挥手。初始阶段服务器处于<code>LISTEN</code>状态(监听状态)。</p>
<h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><ul>
<li><p>第一次握手</p>
<p>客户端向服务器发送连接请求，数据包内容：<code>syn=1</code>，<code>seq=x</code>。<code>x</code>代表一个序列。客户端进入<code>SYN_SENT</code>状态。</p>
</li>
<li><p>第二次握手</p>
<p>服务器向客户端回复同意连接，数据包内容：<code>ack=1</code>，<code>syn=1</code>，<code>seq=x+1</code>。服务端进入<code>SYN_RCVD</code>状态(半连接状态)。</p>
</li>
<li><p>第三次握手</p>
<p>客户端收到服务器发送的同意建立连接的数据包之后，进入<code>ESTABLISHED</code>状态，并向服务器确认建立连接。数据包内容：<code>ack=1</code>，<code>seq=x+2</code>。服务器收到这个数据包之后也进入<code>ESTABLISHED</code>状态。</p>
</li>
</ul>
<h3 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h3><ul>
<li><p>第一次挥手</p>
<p>客户端向服务器发送断开连接请求，数据包内容：<code>fin=1</code>。表示客户端完成了数据传输，客户端进入<code>FIN_WAIT_1</code>状态。</p>
</li>
<li><p>第二次挥手</p>
<p>服务器收到客户端断开连接的请求，发送数据包：<code>ack=1</code>。表示同意断开连接。此时服务器处于<code>CLOSE_WAIT</code>状态。</p>
</li>
<li><p>第三次挥手</p>
<p>等服务器也传输完数据之后，向客户端发送数据包：<code>fin=1</code>。此时服务器进入<code>LAST_ACK</code>状态。</p>
</li>
<li><p>第四次挥手</p>
<p>客户端收到服务器的最后的确认断开请求之后，处于<code>TIME_WAIT</code>状态，向服务器发送数据包：<code>ack=1</code>，表示确认断开。服务器收到数据包之后，正式断开连接。</p>
</li>
</ul>
<p><a href="/../pic/tcp_open_close.jpg" title="img" class="gallery-item" style="box-shadow: none;"> <img src="/../pic/tcp_open_close.jpg" alt="img"></a></p>
<h4 id="backlog半连接池"><a href="#backlog半连接池" class="headerlink" title="backlog半连接池"></a>backlog半连接池</h4><p>半连接池是存在与服务端的一个缓存空间，所有来自客户端的建立连接的初次请求都会存放到半连接池中，服务端从半连接池中获取客户端的请求，然后发送确认连接的数据包。半连接池的空间大小很重要，更大的空间能够抵御洪水SYN攻击，洪水SYN攻击即是第三方模拟大量的客户端发送请求的场景，从而撑满服务端的半连接池，服务端向这些模拟客户端发送确认请求的数据包，模拟客户端并不会给予回应。导致正常的客户端请求无法进入半连接池，显示无法访问。</p>
<h4 id="TCP协议会为什么称为可靠的协议"><a href="#TCP协议会为什么称为可靠的协议" class="headerlink" title="TCP协议会为什么称为可靠的协议"></a>TCP协议会为什么称为可靠的协议</h4><ul>
<li><p>序列号和确认机制</p>
<p>TCP协议为每个发送数据标上seq序列号，并且要求接收方收到数据之后回复ack数据包，保证数据的正确传输和接收。</p>
</li>
<li><p>重传机制</p>
<p>TCP在发送数据之后，并不会立即将数据删除，而是将数据在本地保存为一个副本。如果没有收到接收方的回复包，会重新传输数据包，直到接收方确认收到。缺点是会占用本地的空间。</p>
</li>
<li><p>拥塞控制和流量控制</p>
<ul>
<li>慢启动：根据网络的拥塞程度，由小增大，动态调整发送方的拥塞窗口（cwnd）。</li>
<li>拥塞避免：每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍。</li>
<li>快重传：当发送方连续收到三个重复确认时，就立即重传对方尚未收到的报文段，而不必等待重传计时器到期。</li>
<li>快恢复：数据重传之后，并不会进入慢开始状态，而是将拥塞窗口设置为慢开始门限加三个报文段大小。</li>
</ul>
</li>
</ul>
<h3 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h3><p>想实现网络通信，每台主机需具备四要素</p>
<ul>
<li>本机的IP地址</li>
<li>子网掩码</li>
<li>网关的IP地址</li>
<li>DNS的IP地址</li>
</ul>
<p><strong>DHCP 动态主机配置协议</strong></p>
<p>局域网内的客户机可以通过dhcp自动获取上述内容。</p>
<p>客户机发出的数据包</p>
<table>
<thead>
<tr>
<th>以太网头</th>
<th>ip头</th>
<th>udp头</th>
<th>dhcp数据包</th>
</tr>
</thead>
<tbody><tr>
<td>本机mac         FF-FF-FF-FF-FF-FF</td>
<td>0.0.0.0        255.255.255.255</td>
<td>dhcpclient(68号端口)        dhcpserver(67号端口)</td>
<td>“我需要四要素”</td>
</tr>
</tbody></table>
<blockquote>
<p>最前面的”以太网标头”，设置发出方（本机）的MAC地址和接收方（DHCP服务器）的MAC地址。前者就是本机网卡的MAC地址，后者这时不知道，就填入一个广播地址：FF-FF-FF-FF-FF-FF。</p>
</blockquote>
<blockquote>
<p>后面的”IP标头”，设置发出方的IP地址和接收方的IP地址。这时，对于这两者，本机都不知道。于是，发出方的IP地址就设为0.0.0.0，接收方的IP地址设为255.255.255.255。</p>
</blockquote>
<blockquote>
<p>最后的”UDP标头”，设置发出方的端口和接收方的端口。这一部分是DHCP协议规定好的，发出方是68端口，接收方是67端口。 </p>
</blockquote>
<p>这个数据包构造完成后，就可以发出了。以太网是广播发送，同一个子网络的每台计算机都收到了这个包。因为接收方的MAC地址是FF-FF-FF-FF-FF-FF，看不出是发给谁的，所以每台收到这个包的计算机，还必须分析这个包的IP地址，才能确定是不是发给自己的。当看到发出方IP地址是0.0.0.0，接收方是255.255.255.255，于是DHCP服务器知道”这个包是发给我的”，而其他计算机就可以丢弃这个包。</p>
<p>接下来，DHCP服务器读出这个包的数据内容，分配好IP地址，发送回去一个”DHCP响应”数据包。这个响应包的结构也是类似的，以太网标头的MAC地址是双方的网卡地址，IP标头的IP地址是DHCP服务器的IP地址（发出方）和255.255.255.255（接收方），UDP标头的端口是67（发出方）和68（接收方），分配给请求端的IP地址和本网络的具体参数则包含在Data部分。</p>
<p> DHCP服务器回复的数据包</p>
<table>
<thead>
<tr>
<th>以太网头</th>
<th>ip头</th>
<th>udp头</th>
<th>dhcp数据包</th>
</tr>
</thead>
<tbody><tr>
<td>服务器mac     客户机mac</td>
<td>服务器IP地址       255.255.255.255</td>
<td>dhcpservert(67号端口)        dhcpclient(67号端口)</td>
<td>“这是你要的东西”</td>
</tr>
</tbody></table>
<p>新加入的计算机收到这个响应包，于是就知道了自己的IP地址、子网掩码、网关地址、DNS服务器等等参数</p>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>域名解析服务，将域名解析为IP地址。</p>
<p>DNS的查找顺序：</p>
<pre><code>浏览器缓存-》操作系统缓存-》本地hosts文件-》本地dns服务-》递归or迭代查询
</code></pre>
<p>Linux的hosts文件位置：<code>/etc/hosts</code></p>
<h2 id="查看网络状态"><a href="#查看网络状态" class="headerlink" title="查看网络状态"></a>查看网络状态</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunalp				# 显示当前系统上所有活动的网络连接、监听端口以及与之相关的进程信息</span><br><span class="line">-t：显示TCP连接。</span><br><span class="line">-u：显示UDP连接。</span><br><span class="line">-n：以数值形式显示IP地址和端口号。</span><br><span class="line">-a：显示所有的连接和监听端口。</span><br><span class="line">-l：仅显示监听端口。</span><br><span class="line">-p：显示与进程相关的信息。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i ：[端口号]			# 查看指定端口的占用情况</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -n					# 查看网关信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ping [目标IP地址]  					# ctrl+c结束 测试是否两台主机网络是否通</span><br><span class="line">ping -c [次数] [目标IP地址]			# 设置ping的次数</span><br><span class="line"> </span><br><span class="line"># 在自己的机器上执行，则禁用别人ping自己</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all </span><br></pre></td></tr></table></figure>





</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-08-02</span>
            
                <span>该篇文章被 邓胖胖</span>
            
            
                <span>打上标签:
                    
                    
                        <a href='/tags/Linux/'>
                            Linux
                        </a>
                    
                </span>
             
             
                <span>归为分类:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            学习笔记
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>上一篇：<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">上一篇：<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--这是指一条线往下的内容-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--目录-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--回到顶部按钮-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- 回到顶部的按钮-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- 返回的按钮-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>