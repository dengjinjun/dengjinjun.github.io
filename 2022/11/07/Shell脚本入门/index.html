<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Shell脚本入门" />
    <meta name="hexo-theme-A4" content="v1.9.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Dengpangpang</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--注意：首页既不是post也不是page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--返回顶部css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--目录-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Dengpangpang</a> 
            <span class="description"></span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">🍟首页</a></li>
            
        
            
                <li><a href="/list/">📝文章</a></li>
            
        
            
                <li><a href="/tags/">🏷️标签</a></li>
            
        
            
                <li><a href="/categories/">🗂️分类</a></li>
            
        
            
                <li><a href="/about/">👁️关于</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--说明是文章post页面-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            Shell脚本入门
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%84%9A%E6%9C%AC%E5%88%9B%E5%BB%BA%E5%92%8C%E8%BF%90%E8%A1%8C"><span class="post-toc-text">脚本创建和运行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Shebang-%E8%A1%8C"><span class="post-toc-text">Shebang 行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90%E5%92%8C%E8%B7%AF%E5%BE%84"><span class="post-toc-text">执行权限和路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="post-toc-text">注释</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#source-%E5%91%BD%E4%BB%A4"><span class="post-toc-text">source 命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%84%9A%E6%9C%AC%E5%8F%82%E6%95%B0"><span class="post-toc-text">脚本参数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3%E5%8F%98%E9%87%8F"><span class="post-toc-text">参数相关变量</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#shift-%E5%91%BD%E4%BB%A4"><span class="post-toc-text">shift 命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#getopts-%E5%91%BD%E4%BB%A4"><span class="post-toc-text">getopts 命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%8F%82%E6%95%B0%E7%BB%88%E6%AD%A2%E7%AC%A6"><span class="post-toc-text">配置项参数终止符 --</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%91%BD%E4%BB%A4%E5%8F%8A%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="post-toc-text">命令及脚本执行结果</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="post-toc-text">命令执行结果</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exit-%E5%91%BD%E4%BB%A4"><span class="post-toc-text">exit 命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83"><span class="post-toc-text">脚本编码规范</span></a></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><p>脚本（script）就是包含一系列命令的一个文本文件。Shell 读取这个文件，依次执行里面的所有命令，就好像这些命令直接输入到命令行一样。所有能够在命令行完成的任务，都能够用脚本完成。</p>
<p>脚本的好处是可以重复使用，也可以指定在特定场合自动调用，比如系统启动或关闭时自动执行脚本。</p>
<h2 id="脚本创建和运行"><a href="#脚本创建和运行" class="headerlink" title="脚本创建和运行"></a>脚本创建和运行</h2><h3 id="Shebang-行"><a href="#Shebang-行" class="headerlink" title="Shebang 行"></a>Shebang 行</h3><p>脚本的第一行通常是指定解释器，即这个脚本必须通过什么解释器执行。</p>
<p>这一行以<code>#!</code>字符开头，<code>#!</code>后面就是脚本解释器的位置，Bash 脚本的解释器一般是<code>/bin/sh</code>或<code>/bin/bash</code>。所以这一行就叫做 Shebang 行。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了保险，也可以写成下面这样，返回`bash`可执行文件的位置。（防止如果 Bash 解释器不放在目录`/bin`中）</span></span><br><span class="line"><span class="comment">#!/usr/bin/env bash</span></span><br></pre></td></tr></table></figure>

<p> <code>#!/usr/bin/env NAME</code>这个语法的意思是，让 Shell 查找<code>$PATH</code>环境变量里面第一个匹配的<code>NAME</code>。如果不知道某个命令的具体路径，或者希望兼容其他用户的机器，这样的写法就很有用。</p>
<p>如果没有 Shebang 行，就只能手动将脚本传给解释器来执行。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /bin/sh ./hello.sh</span><br></pre></td></tr></table></figure>

<h3 id="执行权限和路径"><a href="#执行权限和路径" class="headerlink" title="执行权限和路径"></a>执行权限和路径</h3><p>脚本执行的前提条件，就是脚本需要有执行权限。脚本的权限通常设为<code>755</code>（拥有者有所有权限，其他人有读和执行权限）或者<code>700</code>。</p>
<p>除了执行权限，脚本调用时，一般需要指定脚本的路径（比如<code>path/script.sh</code>）。如果将脚本放在环境变量<code>$PATH</code>指定的目录中，就不需要指定路径了。因为 Bash 会自动到这些目录中，寻找是否存在同名的可执行文件。</p>
<p>建议在主目录新建一个<code>~/scripts</code>子目录，专门存放可执行脚本，然后把<code>~/scripts</code>加入<code>$PATH</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:~/scripts		<span class="comment"># 添加环境变量</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc					<span class="comment"># 使配置生效</span></span><br><span class="line">$ hello.sh							<span class="comment"># 不管在什么目录，直接输入脚本文件名，脚本就会执行</span></span><br></pre></td></tr></table></figure>

<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>Bash 脚本中，<code>#</code>表示注释，可以放在行首，也可以放在行尾。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本行是注释</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Hello World!&#x27;</span> <span class="comment"># 井号后面的部分也是注释</span></span><br></pre></td></tr></table></figure>

<p>建议在脚本开头，使用注释说明当前脚本的作用，这样有利于日后的维护。</p>
<h3 id="source-命令"><a href="#source-命令" class="headerlink" title="source 命令"></a>source 命令</h3><p><code>source</code>命令也可以用于执行脚本，通常用于重新加载一个配置文件。**<code>source</code>命令最大的特点是在当前 Shell 执行脚本**，不像直接执行脚本时，会新建一个子 Shell。</p>
<p>所以<code>source</code>命令的另一个用途，是在脚本内部加载外部库。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用`source`命令加载了一个外部库</span></span><br><span class="line"><span class="built_in">source</span> ./lib.sh</span><br><span class="line"><span class="comment"># 使用这个外部库定义的函数</span></span><br><span class="line">function_from_lib</span><br></pre></td></tr></table></figure>

<p><code>source</code>有一个简写形式，可以使用一个点（<code>.</code>）来表示</p>
<h2 id="脚本参数"><a href="#脚本参数" class="headerlink" title="脚本参数"></a>脚本参数</h2><h3 id="参数相关变量"><a href="#参数相关变量" class="headerlink" title="参数相关变量"></a>参数相关变量</h3><p>调用脚本的时候，脚本文件名后面可以带有参数。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ script.sh word1 word2 word3</span><br></pre></td></tr></table></figure>

<p>上面例子中，<code>script.sh</code>是一个脚本文件，<code>word1</code>、<code>word2</code>和<code>word3</code>是三个参数。</p>
<p>脚本文件内部，可以使用特殊变量，引用这些参数。</p>
<ul>
<li><code>$0</code>：脚本文件名，即<code>script.sh</code>。</li>
<li><code>$1</code>~&#96;$9<code>：对应脚本的第一个参数到第九个参数。如果脚本的参数多于9个，那么第10个参数可以用</code>${10}&#96;的形式引用，以此类推。</li>
<li><code>$#</code>：参数的总数。</li>
<li><code>$@</code>：全部的参数，参数之间使用空格分隔。可以理解为是一个包含全部参数的列表。</li>
<li><code>$*</code>：全部的参数，参数之间使用变量<code>$IFS</code>值的第一个字符分隔，默认为空格，但是可以自定义。</li>
</ul>
<p>用户可以输入任意数量的参数，利用<code>for</code>循环，可以读取每一个参数。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>如果多个参数放在双引号里面，视为一个参数。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./script.sh <span class="string">&quot;a b&quot;</span></span><br></pre></td></tr></table></figure>

<p>上面例子中，Bash 会认为<code>&quot;a b&quot;</code>是一个参数，<code>$1</code>会返回<code>a b</code>。注意，返回时不包括双引号。</p>
<h3 id="shift-命令"><a href="#shift-命令" class="headerlink" title="shift 命令"></a>shift 命令</h3><p><code>shift</code>命令可以改变脚本参数，每次执行都会移除脚本当前的第一个参数（<code>$1</code>），使得后面的参数向前一位，即<code>$2</code>变成<code>$1</code>、<code>$3</code>变成<code>$2</code>、<code>$4</code>变成<code>$3</code>，以此类推。</p>
<p><code>while</code>循环结合<code>shift</code>命令，也可以读取每一个参数。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;一共输入了 <span class="variable">$#</span> 个参数&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;剩下 <span class="variable">$#</span> 个参数&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;参数：<span class="variable">$1</span>&quot;</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>上面例子中，<code>shift</code>命令每次移除当前第一个参数，从而通过<code>while</code>循环遍历所有参数。</p>
<p><code>shift</code>命令可以接受一个整数作为参数，指定所要移除的参数个数，默认为<code>1</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">shift</span> 3</span><br></pre></td></tr></table></figure>

<p>上面的命令移除前三个参数，原来的<code>$4</code>变成<code>$1</code>。</p>
<h3 id="getopts-命令"><a href="#getopts-命令" class="headerlink" title="getopts 命令"></a>getopts 命令</h3><p>脚本中经常要处理命令行参数，对于比较复杂的脚本，有些命令行参数是作为以<code>-</code>开头的选项（以下称为<code>opt</code>），有些命令行参数是作为<code>opt</code>的参数（以下称为<code>arg</code>），如果手工处理是很复杂的。这时候可以使用<code>getopts</code>命令。调用格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getopts</span> options variable</span><br><span class="line"><span class="comment"># `options`是一个字符串，给出脚本所有的`opt`，如果`opt`还含有`arg`，就用`:`和其他`opt`隔开。</span></span><br><span class="line"><span class="comment"># `variable`是一个自定义的变量名，用来保存每次取到的`opt`</span></span><br></pre></td></tr></table></figure>

<p><code>getopts</code> 的设计目标是在循环中运行，每次执行循环，<code>getopts</code>就检查下一个命令行参数，并判断它是否为合法<code>opt</code>（即检查参数是否以<code>-</code>开头，且属于 <code>options</code> 中的字母）。如果是，就把<code>opt</code>字母存在指定的变量 <code>variable</code> 中，若在其后面还发现了<code>:</code>，会从该<code>opt</code>后读取其<code>arg</code>，将其保存在特殊的变量<code>OPTARG</code>中，并返回退出状态0；如果 <code>- </code>后面的字母没有包含在 <code>options</code> 中，就在<code> variable</code> 中存入一个<code> ?</code>，并返回退出状态0；如果命令行中已经没有参数，或者下一个参数不以 <code>- </code>开头，就返回不为0的退出状态。</p>
<p><code>OPTIND</code> 表示命令行下一个选项或参数的索引，变量<code>OPTIND</code>在<code>getopts</code>开始执行前是<code>1</code>，然后每次执行就会加<code>1</code>。等到退出<code>while</code>循环，就意味着连词线参数全部处理完毕。这时，<code>$OPTIND - 1</code>就是已经处理的连词线参数个数，使用<code>shift</code>命令将这些参数移除，保证后面的代码可以用<code>$1</code>、<code>$2</code>等处理命令的主参数。</p>
<p>下面是一个例子：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">&#x27;lha:&#x27;</span> OPTION; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$OPTION</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    l)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;linuxconfig&quot;</span></span><br><span class="line">      ;;</span><br><span class="line"></span><br><span class="line">    h)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;h stands for h&quot;</span></span><br><span class="line">      ;;</span><br><span class="line"></span><br><span class="line">    a)</span><br><span class="line">      avalue=<span class="string">&quot;<span class="variable">$OPTARG</span>&quot;</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;The value provided is <span class="variable">$OPTARG</span>&quot;</span></span><br><span class="line">      ;;</span><br><span class="line">    ?)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;script usage: <span class="subst">$(basename $0)</span> [-l] [-h] [-a somevalue]&quot;</span> &gt;&amp;2</span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">      ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">shift</span> <span class="string">&quot;<span class="subst">$(($OPTIND - 1)</span>)&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置项参数终止符"><a href="#配置项参数终止符" class="headerlink" title="配置项参数终止符 --"></a>配置项参数终止符 <code>--</code></h3><p><code>-</code>和<code>--</code>开头的参数，会被 Bash 当作配置项解释。但是，有时它们不是配置项，而是实体参数的一部分，比如文件名叫做<code>-f</code>或<code>--file</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> -f</span><br><span class="line">$ <span class="built_in">cat</span> --file</span><br></pre></td></tr></table></figure>

<p>上面命令的原意是输出文件<code>-f</code>和<code>--file</code>的内容，但是会被 Bash 当作配置项解释。这时就可以使用配置项参数终止符<code>--</code>，它的作用是告诉 Bash，在它后面的参数开头的<code>-</code>和<code>--</code>不是配置项，只能当作实体参数解释。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> -- -f</span><br><span class="line">$ <span class="built_in">cat</span> -- --file</span><br></pre></td></tr></table></figure>

<p>上面命令可以正确展示文件<code>-f</code>和<code>--file</code>的内容，因为它们放在<code>--</code>的后面，开头的<code>-</code>和<code>--</code>就不再当作配置项解释了。</p>
<p>下面是另一个实际的例子，如果想在文件里面搜索<code>--hello</code>，这时也要使用参数终止符<code>--</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ grep -- <span class="string">&quot;--hello&quot;</span> example.txt</span><br></pre></td></tr></table></figure>

<p>上面命令在<code>example.txt</code>文件里面，搜索字符串<code>--hello</code>。这个字符串是<code>--</code>开头，如果不用参数终止符，<code>grep</code>命令就会把<code>--hello</code>当作配置项参数，从而报错。</p>
<h2 id="命令及脚本执行结果"><a href="#命令及脚本执行结果" class="headerlink" title="命令及脚本执行结果"></a>命令及脚本执行结果</h2><h3 id="命令执行结果"><a href="#命令执行结果" class="headerlink" title="命令执行结果"></a>命令执行结果</h3><p>命令执行结束后，会有一个返回值。<code>0</code>表示执行成功，非<code>0</code>（通常是<code>1</code>）表示执行失败。环境变量<code>$?</code>可以读取前一个命令的返回值。</p>
<p>利用这一点，可以在脚本中对命令执行结果进行判断。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/somewhere</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> = <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">rm</span> *</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;无法切换目录！&quot;</span> 1&gt;&amp;2</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>由于<code>if</code>可以直接判断命令的执行结果，执行相应的操作，上面的脚本可以改写成下面的样子。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">cd</span> /path/to/somewhere; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">rm</span> *</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Could not change directory! Aborting.&quot;</span> 1&gt;&amp;2</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>更简洁的写法是利用两个逻辑运算符<code>&amp;&amp;</code>（且）和<code>||</code>（或）。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一步执行成功，才会执行第二步</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/somewhere &amp;&amp; <span class="built_in">rm</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步执行失败，才会执行第二步</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/somewhere || <span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure>

<h3 id="exit-命令"><a href="#exit-命令" class="headerlink" title="exit 命令"></a>exit 命令</h3><p><code>exit</code>命令用于终止当前脚本的执行，并向 Shell 返回一个退出值。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">exit</span>		<span class="comment"># 中止当前脚本，将最后一条命令的退出状态，作为整个脚本的退出状态。</span></span><br></pre></td></tr></table></figure>

<p><code>exit</code>命令后面可以跟参数，该参数就是退出状态。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 退出值为0（成功）</span></span><br><span class="line">$ <span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出值为1（失败）</span></span><br><span class="line">$ <span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure>

<p>退出时，脚本会返回一个退出值。脚本的退出值，<code>0</code>表示正常，<code>1</code>表示发生错误，<code>2</code>表示用法不对，<code>126</code>表示不是可执行脚本，<code>127</code>表示命令没有发现。如果脚本被信号<code>N</code>终止，则退出值为<code>128 + N</code>。简单来说，只要退出值非0，就认为执行出错。</p>
<h2 id="脚本编码规范"><a href="#脚本编码规范" class="headerlink" title="脚本编码规范"></a>脚本编码规范</h2><blockquote>
<p>Shell脚本第一行指定脚本解释器</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">或者</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Shell脚本的开头添加作者、日期、用途等信息</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Date: xxxx</span></span><br><span class="line"><span class="comment"># Author: xxxx</span></span><br><span class="line"><span class="comment"># Description: xxxx</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>尽量使用英文注释</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果一定要添加中文，可以对系统和脚本都设置字符集</span><br><span class="line"><span class="built_in">export</span> LANG=<span class="string">&quot;zh_CN.UTF-8&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Shell脚本应放在固定的路径中，并且以点 .sh 结尾</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /server/scripts</span><br></pre></td></tr></table></figure>

<blockquote>
<p>保持良好的代码编写习惯</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 成对的符号，应当一次性写出来，再退格添加内容</span></span><br><span class="line"><span class="comment"># 中括号两端都至少要有一个空格</span></span><br><span class="line"><span class="comment"># 一次性完成流程控制语句的格式，然后添加内容</span></span><br><span class="line"><span class="comment"># 添加合适的缩进让代码更易读</span></span><br><span class="line"><span class="comment"># 变量的字符串定义加双引号，所见即所得的字符串引用加单引号，命令的引用加反引号</span></span><br><span class="line"><span class="comment"># 等号两边不加空格</span></span><br></pre></td></tr></table></figure>
</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2022-11-07</span>
            
                <span>该篇文章被 邓胖胖</span>
            
            
                <span>打上标签:
                    
                    
                        <a href='/tags/Bash/'>
                            Bash
                        </a>
                    
                </span>
             
             
                <span>归为分类:
                    
                    
                        <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
                            学习笔记
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>上一篇：<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">上一篇：<a href=""></a></span>
    </div> -->

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
             

            
                

            
        </span>
    
</div>
<!--这是指一条线往下的内容-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--目录-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--回到顶部按钮-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- 回到顶部的按钮-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- 返回的按钮-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>